<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Time Intelligence | Understanding Visitors with Social and Geographic Datasets: a tutorial book for local authorities, real estate and retail</title>
  <meta name="description" content="2 Time Intelligence | Understanding Visitors with Social and Geographic Datasets: a tutorial book for local authorities, real estate and retail" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Time Intelligence | Understanding Visitors with Social and Geographic Datasets: a tutorial book for local authorities, real estate and retail" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Time Intelligence | Understanding Visitors with Social and Geographic Datasets: a tutorial book for local authorities, real estate and retail" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="getting-started.html"/>
<link rel="next" href="visitor-behaviour.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.2/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.2.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#conventions"><i class="fa fa-check"></i>Conventions</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#online-version"><i class="fa fa-check"></i>Online Version</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-author"><i class="fa fa-check"></i>About the Author</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>1</b> Getting Started</a><ul>
<li class="chapter" data-level="1.1" data-path="getting-started.html"><a href="getting-started.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction</a></li>
<li class="chapter" data-level="1.2" data-path="getting-started.html"><a href="getting-started.html#location-technologies"><i class="fa fa-check"></i><b>1.2</b> Location Technologies</a></li>
<li class="chapter" data-level="1.3" data-path="getting-started.html"><a href="getting-started.html#vi-data-infrastructure"><i class="fa fa-check"></i><b>1.3</b> VI Data Infrastructure</a></li>
<li class="chapter" data-level="1.4" data-path="getting-started.html"><a href="getting-started.html#privacy-compliant-data-collection-and-use"><i class="fa fa-check"></i><b>1.4</b> Privacy-compliant data collection and use</a></li>
<li class="chapter" data-level="1.5" data-path="getting-started.html"><a href="getting-started.html#representing-and-working-with-data"><i class="fa fa-check"></i><b>1.5</b> Representing and Working with Data</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="time-intelligence.html"><a href="time-intelligence.html"><i class="fa fa-check"></i><b>2</b> Time Intelligence</a><ul>
<li class="chapter" data-level="2.1" data-path="time-intelligence.html"><a href="time-intelligence.html#monthly-visits"><i class="fa fa-check"></i><b>2.1</b> Monthly Visits</a></li>
<li class="chapter" data-level="2.2" data-path="time-intelligence.html"><a href="time-intelligence.html#daily-visits"><i class="fa fa-check"></i><b>2.2</b> Daily Visits</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="visitor-behaviour.html"><a href="visitor-behaviour.html"><i class="fa fa-check"></i><b>3</b> Visitor Behaviour</a><ul>
<li class="chapter" data-level="3.1" data-path="visitor-behaviour.html"><a href="visitor-behaviour.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="visitor-behaviour.html"><a href="visitor-behaviour.html#data-wrangling-and-visualisation"><i class="fa fa-check"></i><b>3.2</b> Data Wrangling and Visualisation</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="visitor-profile.html"><a href="visitor-profile.html"><i class="fa fa-check"></i><b>4</b> Visitor Profile</a><ul>
<li class="chapter" data-level="4.1" data-path="visitor-profile.html"><a href="visitor-profile.html#introduction-2"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="visitor-profile.html"><a href="visitor-profile.html#data-wrangling-and-visualisation-1"><i class="fa fa-check"></i><b>4.2</b> Data Wrangling and Visualisation</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="geospatial-analysis.html"><a href="geospatial-analysis.html"><i class="fa fa-check"></i><b>5</b> Geospatial Analysis</a><ul>
<li class="chapter" data-level="5.1" data-path="geospatial-analysis.html"><a href="geospatial-analysis.html#introduction-3"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="geospatial-analysis.html"><a href="geospatial-analysis.html#data-wrangling-and-visualisation-2"><i class="fa fa-check"></i><b>5.2</b> Data Wrangling and Visualisation</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="location-portfolio-analysis.html"><a href="location-portfolio-analysis.html"><i class="fa fa-check"></i><b>6</b> Location Portfolio Analysis</a><ul>
<li class="chapter" data-level="6.1" data-path="location-portfolio-analysis.html"><a href="location-portfolio-analysis.html#introduction-4"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="location-portfolio-analysis.html"><a href="location-portfolio-analysis.html#data-wrangling-and-visualisation-3"><i class="fa fa-check"></i><b>6.2</b> Data Wrangling and Visualisation</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="competition.html"><a href="competition.html"><i class="fa fa-check"></i><b>7</b> Competition</a><ul>
<li class="chapter" data-level="7.1" data-path="competition.html"><a href="competition.html#introduction-5"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Understanding Visitors with Social and Geographic Datasets: a tutorial book for local authorities, real estate and retail</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="time-intelligence" class="section level1">
<h1><span class="header-section-number">2</span> Time Intelligence</h1>
<hr />
<p>To examine how data vary in time, It is important to explore its general characteristics. The first step prior to any command is to load the data to the space environement and to install some required packages. An R <em>package</em> is a collection of functions, data and documentations. To install an R package, you might use a single line of code:</p>
<p><code>install.packages ("package")</code></p>
<p>You must type that line of code in the console and then press <code>ENTER</code> to run it. R will download the packages from a collection of short programming repository known as <em>CRAN</em> (Comprehensive R Archive Network) and install them onto your computer.</p>
<p>Once the package is installed, you can load it with <code>library()</code> function.</p>
<p>CRAN also provides access to documentation on R, existing mailing lists and the <em>R Bug Tracking system</em>. The basic information about a package is provided in the description file, where you can find out what the package does, who the author is, what version the documentation belongs to, the date, the type of license its use, and the package dependencies. You can also access the description file inside R with the command <code>packageDescription("package")</code>, via the documentation of the package <code>help(package = "package")</code>, or online in the repository of the package.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="time-intelligence.html#cb1-1"></a><span class="co"># install if necessary using &#39;install.packages&#39;</span></span>
<span id="cb1-2"><a href="time-intelligence.html#cb1-2"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="time-intelligence.html#cb1-3"></a><span class="kw">library</span>(lubridate)</span>
<span id="cb1-4"><a href="time-intelligence.html#cb1-4"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb1-5"><a href="time-intelligence.html#cb1-5"></a><span class="kw">library</span>(plotly)</span>
<span id="cb1-6"><a href="time-intelligence.html#cb1-6"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb1-7"><a href="time-intelligence.html#cb1-7"></a><span class="kw">library</span>(scales)</span>
<span id="cb1-8"><a href="time-intelligence.html#cb1-8"></a><span class="kw">library</span>(pipeR)</span>
<span id="cb1-9"><a href="time-intelligence.html#cb1-9"></a><span class="kw">library</span>(CGPfunctions)</span>
<span id="cb1-10"><a href="time-intelligence.html#cb1-10"></a></span>
<span id="cb1-11"><a href="time-intelligence.html#cb1-11"></a></span>
<span id="cb1-12"><a href="time-intelligence.html#cb1-12"></a><span class="co"># load the data provided with the command read()</span></span>
<span id="cb1-13"><a href="time-intelligence.html#cb1-13"></a>data_monthly &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;c:/data/monthly_visits.csv&quot;</span>, <span class="dt">header=</span><span class="ot">TRUE</span>, <span class="dt">fileEncoding=</span><span class="st">&quot;UTF-8-BOM&quot;</span>)</span></code></pre></div>
<p>To transform the content of the field <em>month</em> to format <em>date</em> we use the function <code>mutate()</code>. Dates in R are numeric vectors that represent the number of days since 1 January 1970.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="time-intelligence.html#cb2-1"></a>data_monthly &lt;-<span class="st"> </span>data_monthly <span class="op">%&gt;%</span></span>
<span id="cb2-2"><a href="time-intelligence.html#cb2-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">month =</span> <span class="kw">as.Date</span>(month)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-3"><a href="time-intelligence.html#cb2-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">as.character</span>(year))</span>
<span id="cb2-4"><a href="time-intelligence.html#cb2-4"></a></span>
<span id="cb2-5"><a href="time-intelligence.html#cb2-5"></a><span class="kw">options</span>(<span class="dt">digits=</span><span class="dv">2</span>) <span class="co"># controls the number of digits of numeric values</span></span></code></pre></div>
<p>When you’re looking at many data frame, it is good practice to see its content and extract a summary statistic with the distribution of the data.</p>
<p>The <code>head()</code> function in R is used to display the first <em>n</em> rows present in the input data frame.</p>
<p>You can then produce stratified summary statistics with the function <code>summary()</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="time-intelligence.html#cb3-1"></a><span class="kw">head</span>(data_monthly) <span class="co"># display the firsts lineds of a data frame</span></span></code></pre></div>
<pre><code>##                       name      month    pid  visits year  mm
## 1 Training Shopping Centre 2017-01-01 100001 1715887 2017 Jan
## 2 Training Shopping Centre 2017-02-01 100001 1606814 2017 Feb
## 3 Training Shopping Centre 2017-03-01 100001 1662214 2017 Mar
## 4 Training Shopping Centre 2017-04-01 100001 1603849 2017 Apr
## 5 Training Shopping Centre 2017-05-01 100001 1769676 2017 May
## 6 Training Shopping Centre 2017-06-01 100001 1684730 2017 Jun</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="time-intelligence.html#cb5-1"></a><span class="kw">summary</span>(data_monthly) <span class="co"># present a summary of the data</span></span></code></pre></div>
<pre><code>##      name               month                 pid            visits       
##  Length:54          Min.   :2017-01-01   Min.   :1e+05   Min.   : 342593  
##  Class :character   1st Qu.:2018-02-08   1st Qu.:1e+05   1st Qu.:1604309  
##  Mode  :character   Median :2019-03-16   Median :1e+05   Median :1670654  
##                     Mean   :2019-03-17   Mean   :1e+05   Mean   :1578285  
##                     3rd Qu.:2020-04-23   3rd Qu.:1e+05   3rd Qu.:1737302  
##                     Max.   :2021-06-01   Max.   :1e+05   Max.   :2151060  
##      year                mm           
##  Length:54          Length:54         
##  Class :character   Class :character  
##  Mode  :character   Mode  :character  
##                                       
##                                       
## </code></pre>
<div id="monthly-visits" class="section level2">
<h2><span class="header-section-number">2.1</span> Monthly Visits</h2>
<p>Now that we have stored the data in a consistent format we can explore its content through visualisation.</p>
<p>The first visualisation we can make is to plot the total monthly visits in a line graph.</p>
<p>To produce an interactive, publication-quality graphs, we can use the package <code>plotly()</code><a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="time-intelligence.html#cb7-1"></a>g1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span>data_monthly, <span class="kw">aes</span>(<span class="dt">x=</span>month, <span class="dt">y=</span>visits)) <span class="op">+</span></span>
<span id="cb7-2"><a href="time-intelligence.html#cb7-2"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>comma) <span class="op">+</span></span>
<span id="cb7-3"><a href="time-intelligence.html#cb7-3"></a><span class="st">  </span><span class="kw">geom_area</span>( <span class="dt">fill=</span><span class="st">&quot;#69b3a2&quot;</span>, <span class="dt">alpha=</span><span class="fl">0.4</span>) <span class="op">+</span></span>
<span id="cb7-4"><a href="time-intelligence.html#cb7-4"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color=</span><span class="st">&quot;#69b3a2&quot;</span>) <span class="op">+</span></span>
<span id="cb7-5"><a href="time-intelligence.html#cb7-5"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">2</span>, <span class="dt">colour =</span> <span class="st">&quot;azure4&quot;</span>) <span class="op">+</span></span>
<span id="cb7-6"><a href="time-intelligence.html#cb7-6"></a><span class="st">  </span><span class="kw">theme_light</span>() <span class="op">+</span></span>
<span id="cb7-7"><a href="time-intelligence.html#cb7-7"></a><span class="st">  </span><span class="kw">scale_x_date</span>(<span class="dt">labels =</span> scales<span class="op">::</span><span class="kw">label_date</span>(<span class="st">&quot;%B</span><span class="ch">\n</span><span class="st">%Y&quot;</span>))<span class="op">+</span></span>
<span id="cb7-8"><a href="time-intelligence.html#cb7-8"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y=</span><span class="st">&quot;total visits&quot;</span>, </span>
<span id="cb7-9"><a href="time-intelligence.html#cb7-9"></a>       <span class="dt">x=</span><span class="st">&quot;date&quot;</span>, </span>
<span id="cb7-10"><a href="time-intelligence.html#cb7-10"></a>       <span class="dt">title =</span> <span class="kw">paste</span>(<span class="st">&quot;Total visits by month&quot;</span>))</span>
<span id="cb7-11"><a href="time-intelligence.html#cb7-11"></a></span>
<span id="cb7-12"><a href="time-intelligence.html#cb7-12"></a><span class="kw">ggplotly</span>(g1) <span class="co"># command used to visualise the graph</span></span></code></pre></div>
<div id="htmlwidget-4cd11a7eedd8871c7d50" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-4cd11a7eedd8871c7d50">{"x":{"data":[{"x":[17167,17198,17226,17257,17287,17318,17348,17379,17410,17440,17471,17501,17532,17563,17591,17622,17652,17683,17713,17744,17775,17805,17836,17866,17897,17928,17956,17987,18017,18048,18078,18109,18140,18170,18201,18231,18262,18293,18322,18353,18383,18414,18444,18475,18506,18536,18567,18597,18628,18659,18687,18718,18748,18779,18779,18779,18748,18718,18687,18659,18628,18597,18567,18536,18506,18475,18444,18414,18383,18353,18322,18293,18262,18231,18201,18170,18140,18109,18078,18048,18017,17987,17956,17928,17897,17866,17836,17805,17775,17744,17713,17683,17652,17622,17591,17563,17532,17501,17471,17440,17410,17379,17348,17318,17287,17257,17226,17198,17167,17167],"y":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1675552,1900854,1682763,932183.4,768692.6,650214.1,2027339,970046.3,1744441,1520945,1755307,1392032,880315.1,459212,342592.9,1171877,1711889,1793054,2126618,1632105,1617888,1653831,1689760,1867891,1676112,1785042,1635897,1697083,1553490,1675617,2140461,1605688,1595413,1627995,1665757,1890274,1708760,1783344,1636038,1702490,1555064,1678991,2151060,1641409,1609592,1626082,1681012,1894138,1684730,1769676,1603849,1662214,1606814,1715887,0],"text":["month: 2017-01-01<br />visits: 1715887.0","month: 2017-02-01<br />visits: 1606814.0","month: 2017-03-01<br />visits: 1662214.0","month: 2017-04-01<br />visits: 1603849.0","month: 2017-05-01<br />visits: 1769676.0","month: 2017-06-01<br />visits: 1684730.0","month: 2017-07-01<br />visits: 1894138.0","month: 2017-08-01<br />visits: 1681012.0","month: 2017-09-01<br />visits: 1626082.0","month: 2017-10-01<br />visits: 1609592.0","month: 2017-11-01<br />visits: 1641409.0","month: 2017-12-01<br />visits: 2151060.0","month: 2018-01-01<br />visits: 1678991.0","month: 2018-02-01<br />visits: 1555064.0","month: 2018-03-01<br />visits: 1702490.0","month: 2018-04-01<br />visits: 1636038.0","month: 2018-05-01<br />visits: 1783344.0","month: 2018-06-01<br />visits: 1708760.0","month: 2018-07-01<br />visits: 1890274.0","month: 2018-08-01<br />visits: 1665757.0","month: 2018-09-01<br />visits: 1627995.0","month: 2018-10-01<br />visits: 1595413.0","month: 2018-11-01<br />visits: 1605688.0","month: 2018-12-01<br />visits: 2140461.0","month: 2019-01-01<br />visits: 1675617.0","month: 2019-02-01<br />visits: 1553490.0","month: 2019-03-01<br />visits: 1697083.0","month: 2019-04-01<br />visits: 1635897.0","month: 2019-05-01<br />visits: 1785042.0","month: 2019-06-01<br />visits: 1676112.0","month: 2019-07-01<br />visits: 1867891.0","month: 2019-08-01<br />visits: 1689760.0","month: 2019-09-01<br />visits: 1653831.0","month: 2019-10-01<br />visits: 1617888.0","month: 2019-11-01<br />visits: 1632105.0","month: 2019-12-01<br />visits: 2126618.0","month: 2020-01-01<br />visits: 1793054.0","month: 2020-02-01<br />visits: 1711889.0","month: 2020-03-01<br />visits: 1171877.0","month: 2020-04-01<br />visits:  342592.9","month: 2020-05-01<br />visits:  459212.0","month: 2020-06-01<br />visits:  880315.1","month: 2020-07-01<br />visits: 1392032.0","month: 2020-08-01<br />visits: 1755307.0","month: 2020-09-01<br />visits: 1520945.0","month: 2020-10-01<br />visits: 1744441.0","month: 2020-11-01<br />visits:  970046.3","month: 2020-12-01<br />visits: 2027339.0","month: 2021-01-01<br />visits:  650214.1","month: 2021-02-01<br />visits:  768692.6","month: 2021-03-01<br />visits:  932183.4","month: 2021-04-01<br />visits: 1682763.0","month: 2021-05-01<br />visits: 1900854.0","month: 2021-06-01<br />visits: 1675552.0","month: 2021-06-01<br />visits: 1675552.0","month: 2021-06-01<br />visits: 1675552.0","month: 2021-05-01<br />visits: 1900854.0","month: 2021-04-01<br />visits: 1682763.0","month: 2021-03-01<br />visits:  932183.4","month: 2021-02-01<br />visits:  768692.6","month: 2021-01-01<br />visits:  650214.1","month: 2020-12-01<br />visits: 2027339.0","month: 2020-11-01<br />visits:  970046.3","month: 2020-10-01<br />visits: 1744441.0","month: 2020-09-01<br />visits: 1520945.0","month: 2020-08-01<br />visits: 1755307.0","month: 2020-07-01<br />visits: 1392032.0","month: 2020-06-01<br />visits:  880315.1","month: 2020-05-01<br />visits:  459212.0","month: 2020-04-01<br />visits:  342592.9","month: 2020-03-01<br />visits: 1171877.0","month: 2020-02-01<br />visits: 1711889.0","month: 2020-01-01<br />visits: 1793054.0","month: 2019-12-01<br />visits: 2126618.0","month: 2019-11-01<br />visits: 1632105.0","month: 2019-10-01<br />visits: 1617888.0","month: 2019-09-01<br />visits: 1653831.0","month: 2019-08-01<br />visits: 1689760.0","month: 2019-07-01<br />visits: 1867891.0","month: 2019-06-01<br />visits: 1676112.0","month: 2019-05-01<br />visits: 1785042.0","month: 2019-04-01<br />visits: 1635897.0","month: 2019-03-01<br />visits: 1697083.0","month: 2019-02-01<br />visits: 1553490.0","month: 2019-01-01<br />visits: 1675617.0","month: 2018-12-01<br />visits: 2140461.0","month: 2018-11-01<br />visits: 1605688.0","month: 2018-10-01<br />visits: 1595413.0","month: 2018-09-01<br />visits: 1627995.0","month: 2018-08-01<br />visits: 1665757.0","month: 2018-07-01<br />visits: 1890274.0","month: 2018-06-01<br />visits: 1708760.0","month: 2018-05-01<br />visits: 1783344.0","month: 2018-04-01<br />visits: 1636038.0","month: 2018-03-01<br />visits: 1702490.0","month: 2018-02-01<br />visits: 1555064.0","month: 2018-01-01<br />visits: 1678991.0","month: 2017-12-01<br />visits: 2151060.0","month: 2017-11-01<br />visits: 1641409.0","month: 2017-10-01<br />visits: 1609592.0","month: 2017-09-01<br />visits: 1626082.0","month: 2017-08-01<br />visits: 1681012.0","month: 2017-07-01<br />visits: 1894138.0","month: 2017-06-01<br />visits: 1684730.0","month: 2017-05-01<br />visits: 1769676.0","month: 2017-04-01<br />visits: 1603849.0","month: 2017-03-01<br />visits: 1662214.0","month: 2017-02-01<br />visits: 1606814.0","month: 2017-01-01<br />visits: 1715887.0","month: 2017-01-01<br />visits: 1715887.0"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"transparent","dash":"solid"},"fill":"toself","fillcolor":"rgba(105,179,162,0.4)","hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[17167,17198,17226,17257,17287,17318,17348,17379,17410,17440,17471,17501,17532,17563,17591,17622,17652,17683,17713,17744,17775,17805,17836,17866,17897,17928,17956,17987,18017,18048,18078,18109,18140,18170,18201,18231,18262,18293,18322,18353,18383,18414,18444,18475,18506,18536,18567,18597,18628,18659,18687,18718,18748,18779],"y":[1715887,1606814,1662214,1603849,1769676,1684730,1894138,1681012,1626082,1609592,1641409,2151060,1678991,1555064,1702490,1636038,1783344,1708760,1890274,1665757,1627995,1595413,1605688,2140461,1675617,1553490,1697083,1635897,1785042,1676112,1867891,1689760,1653831,1617888,1632105,2126618,1793054,1711889,1171877,342592.9,459212,880315.1,1392032,1755307,1520945,1744441,970046.3,2027339,650214.1,768692.6,932183.4,1682763,1900854,1675552],"text":["month: 2017-01-01<br />visits: 1715887.0","month: 2017-02-01<br />visits: 1606814.0","month: 2017-03-01<br />visits: 1662214.0","month: 2017-04-01<br />visits: 1603849.0","month: 2017-05-01<br />visits: 1769676.0","month: 2017-06-01<br />visits: 1684730.0","month: 2017-07-01<br />visits: 1894138.0","month: 2017-08-01<br />visits: 1681012.0","month: 2017-09-01<br />visits: 1626082.0","month: 2017-10-01<br />visits: 1609592.0","month: 2017-11-01<br />visits: 1641409.0","month: 2017-12-01<br />visits: 2151060.0","month: 2018-01-01<br />visits: 1678991.0","month: 2018-02-01<br />visits: 1555064.0","month: 2018-03-01<br />visits: 1702490.0","month: 2018-04-01<br />visits: 1636038.0","month: 2018-05-01<br />visits: 1783344.0","month: 2018-06-01<br />visits: 1708760.0","month: 2018-07-01<br />visits: 1890274.0","month: 2018-08-01<br />visits: 1665757.0","month: 2018-09-01<br />visits: 1627995.0","month: 2018-10-01<br />visits: 1595413.0","month: 2018-11-01<br />visits: 1605688.0","month: 2018-12-01<br />visits: 2140461.0","month: 2019-01-01<br />visits: 1675617.0","month: 2019-02-01<br />visits: 1553490.0","month: 2019-03-01<br />visits: 1697083.0","month: 2019-04-01<br />visits: 1635897.0","month: 2019-05-01<br />visits: 1785042.0","month: 2019-06-01<br />visits: 1676112.0","month: 2019-07-01<br />visits: 1867891.0","month: 2019-08-01<br />visits: 1689760.0","month: 2019-09-01<br />visits: 1653831.0","month: 2019-10-01<br />visits: 1617888.0","month: 2019-11-01<br />visits: 1632105.0","month: 2019-12-01<br />visits: 2126618.0","month: 2020-01-01<br />visits: 1793054.0","month: 2020-02-01<br />visits: 1711889.0","month: 2020-03-01<br />visits: 1171877.0","month: 2020-04-01<br />visits:  342592.9","month: 2020-05-01<br />visits:  459212.0","month: 2020-06-01<br />visits:  880315.1","month: 2020-07-01<br />visits: 1392032.0","month: 2020-08-01<br />visits: 1755307.0","month: 2020-09-01<br />visits: 1520945.0","month: 2020-10-01<br />visits: 1744441.0","month: 2020-11-01<br />visits:  970046.3","month: 2020-12-01<br />visits: 2027339.0","month: 2021-01-01<br />visits:  650214.1","month: 2021-02-01<br />visits:  768692.6","month: 2021-03-01<br />visits:  932183.4","month: 2021-04-01<br />visits: 1682763.0","month: 2021-05-01<br />visits: 1900854.0","month: 2021-06-01<br />visits: 1675552.0"],"type":"scatter","mode":"lines+markers","line":{"width":1.88976377952756,"color":"rgba(105,179,162,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","marker":{"autocolorscale":false,"color":"rgba(131,139,139,1)","opacity":1,"size":7.55905511811024,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(131,139,139,1)"}},"frame":null}],"layout":{"margin":{"t":43.7625570776256,"r":7.30593607305936,"b":40.1826484018265,"l":78.1735159817352},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"title":{"text":"Total visits by month","font":{"color":"rgba(0,0,0,1)","family":"","size":17.5342465753425},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[17086.4,18859.6],"tickmode":"array","ticktext":["January<br />2017","January<br />2018","January<br />2019","January<br />2020","January<br />2021"],"tickvals":[17167,17532,17897,18262,18628],"categoryorder":"array","categoryarray":["January<br />2017","January<br />2018","January<br />2019","January<br />2020","January<br />2021"],"nticks":null,"ticks":"outside","tickcolor":"rgba(179,179,179,1)","ticklen":3.65296803652968,"tickwidth":0.33208800332088,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(222,222,222,1)","gridwidth":0.33208800332088,"zeroline":false,"anchor":"y","title":{"text":"date","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-107553,2258613],"tickmode":"array","ticktext":["0","500,000","1,000,000","1,500,000","2,000,000"],"tickvals":[0,500000,1000000,1500000,2000000],"categoryorder":"array","categoryarray":["0","500,000","1,000,000","1,500,000","2,000,000"],"nticks":null,"ticks":"outside","tickcolor":"rgba(179,179,179,1)","ticklen":3.65296803652968,"tickwidth":0.33208800332088,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(222,222,222,1)","gridwidth":0.33208800332088,"zeroline":false,"anchor":"x","title":{"text":"total visits","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(179,179,179,1)","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"503c486832a5":{"x":{},"y":{},"type":"scatter"},"503cedb5fae":{"x":{},"y":{}},"503c256d6644":{"x":{},"y":{}}},"cur_data":"503c486832a5","visdat":{"503c486832a5":["function (y) ","x"],"503cedb5fae":["function (y) ","x"],"503c256d6644":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>Instead of generating an interactive graph, we can also drawn a graph with additional elements like annotations and caption information like the source of data.</p>
<p>In this example, you can see that we use the same package <code>ggplot2()</code> to set up the graph. An annotation lable displays in the graph the initial enforced lockdown in the UK in 2020.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="time-intelligence.html#cb8-1"></a>g2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data_monthly, <span class="kw">aes</span>(month, visits)) <span class="op">+</span></span>
<span id="cb8-2"><a href="time-intelligence.html#cb8-2"></a><span class="st">  </span><span class="kw">scale_x_date</span>(<span class="dt">labels =</span> scales<span class="op">::</span><span class="kw">label_date</span>(<span class="st">&quot;%B</span><span class="ch">\n</span><span class="st">%Y&quot;</span>)) <span class="op">+</span></span>
<span id="cb8-3"><a href="time-intelligence.html#cb8-3"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>comma)<span class="op">+</span></span>
<span id="cb8-4"><a href="time-intelligence.html#cb8-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">colour =</span> <span class="st">&quot;blue&quot;</span> ,</span>
<span id="cb8-5"><a href="time-intelligence.html#cb8-5"></a>             <span class="dt">size =</span> <span class="dv">3</span>, </span>
<span id="cb8-6"><a href="time-intelligence.html#cb8-6"></a>             <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">+</span></span>
<span id="cb8-7"><a href="time-intelligence.html#cb8-7"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">na.rm =</span> <span class="ot">TRUE</span>,</span>
<span id="cb8-8"><a href="time-intelligence.html#cb8-8"></a>            <span class="dt">colour =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span></span>
<span id="cb8-9"><a href="time-intelligence.html#cb8-9"></a><span class="st">  </span><span class="kw">annotate</span>(</span>
<span id="cb8-10"><a href="time-intelligence.html#cb8-10"></a>    <span class="dt">geom =</span> <span class="st">&quot;segment&quot;</span>, <span class="dt">x =</span> <span class="kw">ymd</span>(<span class="st">&quot;2020-03-23&quot;</span>), <span class="dt">y =</span> <span class="dv">2000000</span>, <span class="dt">xend =</span> <span class="kw">ymd</span>(<span class="st">&quot;2020-03-23&quot;</span>), <span class="dt">yend =</span> <span class="dv">1800000</span>, </span>
<span id="cb8-11"><a href="time-intelligence.html#cb8-11"></a>    <span class="dt">arrow =</span> <span class="kw">arrow</span>(<span class="dt">length =</span> <span class="kw">unit</span>(<span class="dv">2</span>, <span class="st">&quot;mm&quot;</span>))</span>
<span id="cb8-12"><a href="time-intelligence.html#cb8-12"></a>  ) <span class="op">+</span></span>
<span id="cb8-13"><a href="time-intelligence.html#cb8-13"></a><span class="st">  </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="kw">ymd</span>(<span class="st">&quot;2020-03-12&quot;</span>), <span class="dt">y =</span> <span class="dv">2150000</span>,  <span class="dt">label =</span> <span class="st">&quot;lockdown</span><span class="ch">\n</span><span class="st">23 March 2020&quot;</span>, <span class="dt">hjust =</span> <span class="st">&quot;left&quot;</span>)</span>
<span id="cb8-14"><a href="time-intelligence.html#cb8-14"></a></span>
<span id="cb8-15"><a href="time-intelligence.html#cb8-15"></a></span>
<span id="cb8-16"><a href="time-intelligence.html#cb8-16"></a>g2 <span class="op">+</span></span>
<span id="cb8-17"><a href="time-intelligence.html#cb8-17"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">y=</span><span class="st">&quot;total visits&quot;</span>, </span>
<span id="cb8-18"><a href="time-intelligence.html#cb8-18"></a>       <span class="dt">x=</span><span class="st">&quot;date&quot;</span>, </span>
<span id="cb8-19"><a href="time-intelligence.html#cb8-19"></a>       <span class="dt">title =</span> <span class="kw">paste</span>(<span class="st">&quot;Total visits by month&quot;</span>),</span>
<span id="cb8-20"><a href="time-intelligence.html#cb8-20"></a>       <span class="dt">caption =</span> <span class="st">&quot;Source: Visitor Insights&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>Suppose we wish to explore the seasonality effects in the monthly visits. For instance, we know that December is the most busy time of the year for retail with Christmas and new year celebrations. We can plot the very same data in a graph transforming the x-axis to display the months instead of dates.</p>
<p>Note that we use the field <em>mm</em> to set up the graph. <code>fct_relevel()</code> is used to order the months in the correct way. A legend is also displayed setting the colours for the years.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="time-intelligence.html#cb9-1"></a><span class="co"># transform the format of the month field  </span></span>
<span id="cb9-2"><a href="time-intelligence.html#cb9-2"></a>data_monthly &lt;-<span class="st"> </span>data_monthly <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb9-3"><a href="time-intelligence.html#cb9-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mm =</span> <span class="kw">fct_relevel</span>(mm, </span>
<span id="cb9-4"><a href="time-intelligence.html#cb9-4"></a>                          <span class="st">&quot;Jan&quot;</span>, <span class="st">&quot;Feb&quot;</span>, <span class="st">&quot;Mar&quot;</span>,<span class="st">&quot;Apr&quot;</span>, <span class="st">&quot;May&quot;</span>, <span class="st">&quot;Jun&quot;</span>, </span>
<span id="cb9-5"><a href="time-intelligence.html#cb9-5"></a>                          <span class="st">&quot;Jul&quot;</span>, <span class="st">&quot;Aug&quot;</span>, <span class="st">&quot;Sep&quot;</span>, <span class="st">&quot;Oct&quot;</span>, <span class="st">&quot;Nov&quot;</span>, <span class="st">&quot;Dec&quot;</span>)) </span>
<span id="cb9-6"><a href="time-intelligence.html#cb9-6"></a></span>
<span id="cb9-7"><a href="time-intelligence.html#cb9-7"></a></span>
<span id="cb9-8"><a href="time-intelligence.html#cb9-8"></a>g3 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data_monthly, <span class="kw">aes</span>(mm, visits, <span class="dt">color =</span> year)) <span class="op">+</span></span>
<span id="cb9-9"><a href="time-intelligence.html#cb9-9"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>comma) <span class="op">+</span></span>
<span id="cb9-10"><a href="time-intelligence.html#cb9-10"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> year), <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb9-11"><a href="time-intelligence.html#cb9-11"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">group =</span> year), <span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb9-12"><a href="time-intelligence.html#cb9-12"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="st">&#39;Program Type&#39;</span>)</span>
<span id="cb9-13"><a href="time-intelligence.html#cb9-13"></a></span>
<span id="cb9-14"><a href="time-intelligence.html#cb9-14"></a>g3 <span class="op">+</span></span>
<span id="cb9-15"><a href="time-intelligence.html#cb9-15"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="op">+</span></span>
<span id="cb9-16"><a href="time-intelligence.html#cb9-16"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y=</span><span class="st">&quot;total visits&quot;</span>, </span>
<span id="cb9-17"><a href="time-intelligence.html#cb9-17"></a>       <span class="dt">x=</span><span class="st">&quot;month&quot;</span>, </span>
<span id="cb9-18"><a href="time-intelligence.html#cb9-18"></a>       <span class="dt">title =</span> <span class="kw">paste</span>(<span class="st">&quot;Total visits by month&quot;</span>),</span>
<span id="cb9-19"><a href="time-intelligence.html#cb9-19"></a>       <span class="dt">caption =</span> <span class="st">&quot;Source: Visitor Insights&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Another way to explore seasonality is using <em>faceting</em>. Faceting generates small multiples each showing a different subset of the data, for example the years in a table. It is a powerful tool for exploratory data analysis: you can rapidly compare patterns in different parts of the data and see whether they are the same or different.</p>
<p><code>facet_wrap()</code> makes a ribbon of panels (generated by any number of variables) and wraps it into 2d. In the example below we set up a feceting graph arranging each panel to display the data for a particular year.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="time-intelligence.html#cb10-1"></a>g4  &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data_monthly, <span class="kw">aes</span>(mm, visits, <span class="dt">color =</span> year)) <span class="op">+</span></span>
<span id="cb10-2"><a href="time-intelligence.html#cb10-2"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>comma) <span class="op">+</span></span>
<span id="cb10-3"><a href="time-intelligence.html#cb10-3"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> year), <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb10-4"><a href="time-intelligence.html#cb10-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">group =</span> year), <span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb10-5"><a href="time-intelligence.html#cb10-5"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="st">&#39;Program Type&#39;</span>) <span class="op">+</span></span>
<span id="cb10-6"><a href="time-intelligence.html#cb10-6"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>year,<span class="dt">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb10-7"><a href="time-intelligence.html#cb10-7"></a></span>
<span id="cb10-8"><a href="time-intelligence.html#cb10-8"></a>g4 <span class="op">+</span></span>
<span id="cb10-9"><a href="time-intelligence.html#cb10-9"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), <span class="dt">legend.justification =</span> <span class="kw">c</span>(<span class="fl">2.5</span>, <span class="dv">0</span>))<span class="op">+</span></span>
<span id="cb10-10"><a href="time-intelligence.html#cb10-10"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y=</span><span class="st">&quot;total visits&quot;</span>, </span>
<span id="cb10-11"><a href="time-intelligence.html#cb10-11"></a>       <span class="dt">x=</span><span class="st">&quot;month&quot;</span>, </span>
<span id="cb10-12"><a href="time-intelligence.html#cb10-12"></a>       <span class="dt">title =</span> <span class="kw">paste</span>(<span class="st">&quot;Total visits by month&quot;</span>),</span>
<span id="cb10-13"><a href="time-intelligence.html#cb10-13"></a>       <span class="dt">caption =</span> <span class="st">&quot;Source: Visitor Insights&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>We may also need to display a summary of total visits by year. In this example, it would make sense to display the numbers for 2017 to 2020, discarding 2021 as far as we do not have the full completed data for this year.</p>
<p>First we filter for the years with the function <code>filter()</code>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="time-intelligence.html#cb11-1"></a>data_year &lt;-<span class="st"> </span><span class="kw">select</span>(data_monthly, year, visits) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-2"><a href="time-intelligence.html#cb11-2"></a><span class="st">  </span><span class="kw">filter</span> (year <span class="op">==</span><span class="st"> &quot;2017&quot;</span><span class="op">|</span><span class="st"> </span>year <span class="op">==</span><span class="st"> &quot;2018&quot;</span> <span class="op">|</span><span class="st"> </span>year <span class="op">==</span><span class="st"> &quot;2019&quot;</span> <span class="op">|</span><span class="st"> </span>year <span class="op">==</span><span class="st"> &quot;2020&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-3"><a href="time-intelligence.html#cb11-3"></a><span class="st">  </span><span class="kw">group_by</span>(year) <span class="op">%&gt;%</span></span>
<span id="cb11-4"><a href="time-intelligence.html#cb11-4"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">visits =</span>  <span class="kw">sum</span>(visits))</span></code></pre></div>
<p>We can than set up and display the graph.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="time-intelligence.html#cb12-1"></a>g5 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data_year, <span class="kw">aes</span>(year, visits)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb12-2"><a href="time-intelligence.html#cb12-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span></span>
<span id="cb12-3"><a href="time-intelligence.html#cb12-3"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> <span class="kw">comma_format</span>(), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">22000000</span>)) <span class="op">+</span></span>
<span id="cb12-4"><a href="time-intelligence.html#cb12-4"></a><span class="st">  </span><span class="kw">theme_grey</span>()  <span class="op">+</span></span>
<span id="cb12-5"><a href="time-intelligence.html#cb12-5"></a><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">fill =</span> <span class="st">&quot;gray41&quot;</span>) <span class="op">+</span></span>
<span id="cb12-6"><a href="time-intelligence.html#cb12-6"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">y =</span> visits, <span class="dt">label =</span> scales<span class="op">::</span><span class="kw">comma</span>(<span class="kw">round</span>(visits), <span class="dt">accuracy=</span><span class="dv">1</span>)),</span>
<span id="cb12-7"><a href="time-intelligence.html#cb12-7"></a>            <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">0.9</span>),</span>
<span id="cb12-8"><a href="time-intelligence.html#cb12-8"></a>            <span class="dt">size =</span> <span class="dv">5</span>,</span>
<span id="cb12-9"><a href="time-intelligence.html#cb12-9"></a>            <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb12-10"><a href="time-intelligence.html#cb12-10"></a>            <span class="dt">vjust =</span> <span class="fl">-1.0</span>) <span class="op">+</span></span>
<span id="cb12-11"><a href="time-intelligence.html#cb12-11"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y=</span><span class="st">&quot;total visits&quot;</span>, </span>
<span id="cb12-12"><a href="time-intelligence.html#cb12-12"></a>       <span class="dt">x=</span><span class="st">&quot;year&quot;</span>, </span>
<span id="cb12-13"><a href="time-intelligence.html#cb12-13"></a>       <span class="dt">title=</span><span class="st">&quot;Total visits&quot;</span>, </span>
<span id="cb12-14"><a href="time-intelligence.html#cb12-14"></a>       <span class="dt">caption =</span> <span class="st">&quot;Source: Visitor Insights&quot;</span>) </span>
<span id="cb12-15"><a href="time-intelligence.html#cb12-15"></a></span>
<span id="cb12-16"><a href="time-intelligence.html#cb12-16"></a>g5 <span class="op">+</span></span>
<span id="cb12-17"><a href="time-intelligence.html#cb12-17"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;linen&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>
<div id="daily-visits" class="section level2">
<h2><span class="header-section-number">2.2</span> Daily Visits</h2>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="time-intelligence.html#cb13-1"></a>data_daily &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;C:/Users/Laurent/OneDrive - ROCS/VI/daily_visits.csv&quot;</span>)</span>
<span id="cb13-2"><a href="time-intelligence.html#cb13-2"></a></span>
<span id="cb13-3"><a href="time-intelligence.html#cb13-3"></a></span>
<span id="cb13-4"><a href="time-intelligence.html#cb13-4"></a>data_daily &lt;-<span class="st"> </span><span class="kw">mutate</span>(data_daily,</span>
<span id="cb13-5"><a href="time-intelligence.html#cb13-5"></a>                     <span class="dt">date =</span><span class="kw">as.Date</span>(day, <span class="dt">format=</span><span class="st">&quot;%d/%m/%Y&quot;</span>))</span>
<span id="cb13-6"><a href="time-intelligence.html#cb13-6"></a></span>
<span id="cb13-7"><a href="time-intelligence.html#cb13-7"></a></span>
<span id="cb13-8"><a href="time-intelligence.html#cb13-8"></a>data_daily &lt;-<span class="st"> </span><span class="kw">mutate</span> (data_daily,</span>
<span id="cb13-9"><a href="time-intelligence.html#cb13-9"></a>                      <span class="dt">wday =</span> <span class="kw">wday</span>(date, <span class="dt">label =</span> <span class="ot">TRUE</span>), </span>
<span id="cb13-10"><a href="time-intelligence.html#cb13-10"></a>                      <span class="dt">week =</span> <span class="kw">week</span> (date), </span>
<span id="cb13-11"><a href="time-intelligence.html#cb13-11"></a>                      <span class="dt">year =</span> <span class="kw">year</span> (date),</span>
<span id="cb13-12"><a href="time-intelligence.html#cb13-12"></a>                      <span class="dt">month =</span> <span class="kw">month</span> (date), </span>
<span id="cb13-13"><a href="time-intelligence.html#cb13-13"></a>                      <span class="dt">hour =</span> <span class="kw">hour</span> (date))</span>
<span id="cb13-14"><a href="time-intelligence.html#cb13-14"></a></span>
<span id="cb13-15"><a href="time-intelligence.html#cb13-15"></a></span>
<span id="cb13-16"><a href="time-intelligence.html#cb13-16"></a></span>
<span id="cb13-17"><a href="time-intelligence.html#cb13-17"></a>data_daily &lt;-<span class="st"> </span>data_daily <span class="op">%&gt;%</span></span>
<span id="cb13-18"><a href="time-intelligence.html#cb13-18"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">wday =</span> <span class="kw">fct_relevel</span>(wday, </span>
<span id="cb13-19"><a href="time-intelligence.html#cb13-19"></a>                            <span class="st">&quot;Mon&quot;</span>, <span class="st">&quot;Tue&quot;</span>, <span class="st">&quot;Wed&quot;</span>,<span class="st">&quot;Thu&quot;</span>, <span class="st">&quot;Fri&quot;</span>, <span class="st">&quot;Sat&quot;</span>, </span>
<span id="cb13-20"><a href="time-intelligence.html#cb13-20"></a>                            <span class="st">&quot;Sun&quot;</span>)) </span>
<span id="cb13-21"><a href="time-intelligence.html#cb13-21"></a></span>
<span id="cb13-22"><a href="time-intelligence.html#cb13-22"></a>data_daily_avg &lt;-<span class="st"> </span>data_daily <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-23"><a href="time-intelligence.html#cb13-23"></a><span class="st">  </span><span class="kw">group_by</span>(wday) <span class="op">%&gt;%</span></span>
<span id="cb13-24"><a href="time-intelligence.html#cb13-24"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">visits =</span> <span class="kw">mean</span>(visits)) </span>
<span id="cb13-25"><a href="time-intelligence.html#cb13-25"></a></span>
<span id="cb13-26"><a href="time-intelligence.html#cb13-26"></a></span>
<span id="cb13-27"><a href="time-intelligence.html#cb13-27"></a>g5 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data_daily_avg, <span class="kw">aes</span>(<span class="dt">x =</span> wday, <span class="dt">y =</span> visits)) <span class="op">+</span></span>
<span id="cb13-28"><a href="time-intelligence.html#cb13-28"></a><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">fill =</span> <span class="st">&quot;cyan4&quot;</span>) <span class="op">+</span></span>
<span id="cb13-29"><a href="time-intelligence.html#cb13-29"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>comma) <span class="op">+</span></span>
<span id="cb13-30"><a href="time-intelligence.html#cb13-30"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">y =</span> visits, <span class="dt">label =</span> scales<span class="op">::</span><span class="kw">comma</span>(<span class="kw">round</span>(visits), <span class="dt">accuracy=</span><span class="dv">1</span>)),</span>
<span id="cb13-31"><a href="time-intelligence.html#cb13-31"></a>            <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">0.5</span>),</span>
<span id="cb13-32"><a href="time-intelligence.html#cb13-32"></a>            <span class="dt">size =</span> <span class="dv">5</span>,</span>
<span id="cb13-33"><a href="time-intelligence.html#cb13-33"></a>            <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb13-34"><a href="time-intelligence.html#cb13-34"></a>            <span class="dt">vjust =</span> <span class="fl">-0.1</span>)</span>
<span id="cb13-35"><a href="time-intelligence.html#cb13-35"></a></span>
<span id="cb13-36"><a href="time-intelligence.html#cb13-36"></a>g5 <span class="op">+</span></span>
<span id="cb13-37"><a href="time-intelligence.html#cb13-37"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Total visits by day&quot;</span>,</span>
<span id="cb13-38"><a href="time-intelligence.html#cb13-38"></a>      <span class="dt">y=</span><span class="st">&quot;average daily visits&quot;</span>, </span>
<span id="cb13-39"><a href="time-intelligence.html#cb13-39"></a>      <span class="dt">x=</span><span class="st">&quot;day&quot;</span>,</span>
<span id="cb13-40"><a href="time-intelligence.html#cb13-40"></a>      <span class="dt">caption =</span> <span class="st">&quot;Source: Visitor Insights&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="time-intelligence.html#cb14-1"></a>data_daily_avg_year &lt;-<span class="st"> </span>data_daily <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-2"><a href="time-intelligence.html#cb14-2"></a><span class="st">  </span><span class="kw">group_by</span>(wday, year) <span class="op">%&gt;%</span></span>
<span id="cb14-3"><a href="time-intelligence.html#cb14-3"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">visits =</span> <span class="kw">mean</span>(visits)) </span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;wday&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="time-intelligence.html#cb16-1"></a>g5 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data_daily_avg_year, <span class="kw">aes</span>(<span class="dt">x =</span> wday, <span class="dt">y =</span> visits)) <span class="op">+</span></span>
<span id="cb16-2"><a href="time-intelligence.html#cb16-2"></a><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">fill =</span> <span class="st">&quot;cyan4&quot;</span>)<span class="op">+</span></span>
<span id="cb16-3"><a href="time-intelligence.html#cb16-3"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>comma) <span class="op">+</span></span>
<span id="cb16-4"><a href="time-intelligence.html#cb16-4"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> <span class="kw">round</span>(visits, <span class="dv">0</span>)), <span class="dt">vjust =</span> <span class="fl">-0.2</span>, <span class="dt">size =</span> <span class="fl">2.5</span>) <span class="op">+</span></span>
<span id="cb16-5"><a href="time-intelligence.html#cb16-5"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>year)</span>
<span id="cb16-6"><a href="time-intelligence.html#cb16-6"></a></span>
<span id="cb16-7"><a href="time-intelligence.html#cb16-7"></a></span>
<span id="cb16-8"><a href="time-intelligence.html#cb16-8"></a>g5 <span class="op">+</span></span>
<span id="cb16-9"><a href="time-intelligence.html#cb16-9"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y=</span><span class="st">&quot;average daily visits&quot;</span>, </span>
<span id="cb16-10"><a href="time-intelligence.html#cb16-10"></a>       <span class="dt">x=</span><span class="st">&quot;day&quot;</span>,</span>
<span id="cb16-11"><a href="time-intelligence.html#cb16-11"></a>       <span class="dt">caption =</span> <span class="st">&quot;Source: Visitor Insights&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="time-intelligence.html#cb17-1"></a>g5 &lt;-<span class="st">   </span><span class="kw">ggplot</span>(data_daily, <span class="kw">aes</span>(<span class="dt">x=</span>wday,<span class="dt">y=</span>visits, <span class="dt">fill=</span>wday)) <span class="op">+</span></span>
<span id="cb17-2"><a href="time-intelligence.html#cb17-2"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>comma) <span class="op">+</span></span>
<span id="cb17-3"><a href="time-intelligence.html#cb17-3"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">outlier.shape =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb17-4"><a href="time-intelligence.html#cb17-4"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>year) <span class="op">+</span></span>
<span id="cb17-5"><a href="time-intelligence.html#cb17-5"></a><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">150000</span>)) <span class="op">+</span></span>
<span id="cb17-6"><a href="time-intelligence.html#cb17-6"></a><span class="st">  </span><span class="kw">stat_summary</span>(<span class="dt">fun =</span> mean, <span class="dt">geom=</span><span class="st">&quot;point&quot;</span>, <span class="dt">shape=</span><span class="dv">20</span>, <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb17-7"><a href="time-intelligence.html#cb17-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y=</span><span class="st">&quot;daily visits&quot;</span>, </span>
<span id="cb17-8"><a href="time-intelligence.html#cb17-8"></a>       <span class="dt">x=</span><span class="st">&quot;day&quot;</span>, </span>
<span id="cb17-9"><a href="time-intelligence.html#cb17-9"></a>       <span class="dt">title=</span><span class="st">&quot;Visits by day&quot;</span>, </span>
<span id="cb17-10"><a href="time-intelligence.html#cb17-10"></a>       <span class="dt">caption =</span> <span class="st">&quot;Source: Visitor Insights&quot;</span>)</span>
<span id="cb17-11"><a href="time-intelligence.html#cb17-11"></a></span>
<span id="cb17-12"><a href="time-intelligence.html#cb17-12"></a>g5 <span class="op">+</span></span>
<span id="cb17-13"><a href="time-intelligence.html#cb17-13"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), <span class="dt">legend.justification =</span> <span class="kw">c</span>(<span class="fl">1.2</span>, <span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb17-14"><a href="time-intelligence.html#cb17-14"></a><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="kw">guide_legend</span>(<span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="time-intelligence.html#cb18-1"></a>data_hour &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;C:/Users/Laurent/OneDrive - ROCS/VI/visit_hour.csv&quot;</span>, <span class="dt">header=</span><span class="ot">TRUE</span>, <span class="dt">fileEncoding=</span><span class="st">&quot;UTF-8-BOM&quot;</span>)</span>
<span id="cb18-2"><a href="time-intelligence.html#cb18-2"></a></span>
<span id="cb18-3"><a href="time-intelligence.html#cb18-3"></a>data_hour &lt;-<span class="st"> </span>data_hour <span class="op">%&gt;%</span></span>
<span id="cb18-4"><a href="time-intelligence.html#cb18-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">as.character</span>(year))</span>
<span id="cb18-5"><a href="time-intelligence.html#cb18-5"></a></span>
<span id="cb18-6"><a href="time-intelligence.html#cb18-6"></a></span>
<span id="cb18-7"><a href="time-intelligence.html#cb18-7"></a><span class="kw">as_tibble</span>(data_hour)</span></code></pre></div>
<pre><code>## # A tibble: 120 x 7
##       pid name                   year   hour avg_visits total_visits_ye~     pct
##     &lt;int&gt; &lt;chr&gt;                  &lt;chr&gt; &lt;int&gt;      &lt;dbl&gt;            &lt;dbl&gt;   &lt;dbl&gt;
##  1 374342 intu Merry Hill, West~ 2017      0       340.           59710. 0.00569
##  2 374342 intu Merry Hill, West~ 2017      1       293.           59710. 0.00490
##  3 374342 intu Merry Hill, West~ 2017      2       327.           59710. 0.00547
##  4 374342 intu Merry Hill, West~ 2017      3       280.           59710. 0.00469
##  5 374342 intu Merry Hill, West~ 2017      4       342.           59710. 0.00573
##  6 374342 intu Merry Hill, West~ 2017      5       337.           59710. 0.00564
##  7 374342 intu Merry Hill, West~ 2017      6       739.           59710. 0.0124 
##  8 374342 intu Merry Hill, West~ 2017      7       946.           59710. 0.0159 
##  9 374342 intu Merry Hill, West~ 2017      8      1506.           59710. 0.0252 
## 10 374342 intu Merry Hill, West~ 2017      9      2580.           59710. 0.0432 
## # ... with 110 more rows</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="time-intelligence.html#cb20-1"></a>g13 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data_hour, <span class="kw">aes</span>(<span class="dt">x=</span>hour, <span class="dt">y=</span>pct)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb20-2"><a href="time-intelligence.html#cb20-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>)<span class="op">+</span></span>
<span id="cb20-3"><a href="time-intelligence.html#cb20-3"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>year,<span class="dt">nrow =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb20-4"><a href="time-intelligence.html#cb20-4"></a><span class="st">  </span><span class="kw">theme_light</span>()<span class="op">+</span></span>
<span id="cb20-5"><a href="time-intelligence.html#cb20-5"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels=</span>percent) <span class="op">+</span></span>
<span id="cb20-6"><a href="time-intelligence.html#cb20-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y=</span><span class="st">&quot;perc (%)&quot;</span>, </span>
<span id="cb20-7"><a href="time-intelligence.html#cb20-7"></a>       <span class="dt">x=</span><span class="st">&quot;hour&quot;</span>, </span>
<span id="cb20-8"><a href="time-intelligence.html#cb20-8"></a>       <span class="dt">title=</span><span class="st">&quot;Visits by hour (%)&quot;</span>, </span>
<span id="cb20-9"><a href="time-intelligence.html#cb20-9"></a>       <span class="dt">caption =</span> <span class="st">&quot;Source: Visitor Insights&quot;</span>)</span>
<span id="cb20-10"><a href="time-intelligence.html#cb20-10"></a></span>
<span id="cb20-11"><a href="time-intelligence.html#cb20-11"></a><span class="kw">plot</span>(g13)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="time-intelligence.html#cb21-1"></a><span class="co">## time ranges</span></span>
<span id="cb21-2"><a href="time-intelligence.html#cb21-2"></a>morning &lt;-<span class="st"> </span><span class="kw">filter</span> (data_hour, hour <span class="op">==</span><span class="st"> &quot;6&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;7&quot;</span><span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;8&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;9&quot;</span>)</span>
<span id="cb21-3"><a href="time-intelligence.html#cb21-3"></a>mid_morning &lt;-<span class="st"> </span><span class="kw">filter</span> (data_hour, hour <span class="op">==</span><span class="st"> &quot;10&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;11&quot;</span>)</span>
<span id="cb21-4"><a href="time-intelligence.html#cb21-4"></a>noon &lt;-<span class="st"> </span><span class="kw">filter</span>  (data_hour, hour <span class="op">==</span><span class="st"> &quot;12&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;13&quot;</span>)</span>
<span id="cb21-5"><a href="time-intelligence.html#cb21-5"></a>afternoon &lt;-<span class="st"> </span><span class="kw">filter</span> (data_hour, hour <span class="op">==</span><span class="st"> &quot;14&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;15&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;16&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;17&quot;</span>)</span>
<span id="cb21-6"><a href="time-intelligence.html#cb21-6"></a>evening &lt;-<span class="st"> </span><span class="kw">filter</span> (data_hour, hour <span class="op">==</span><span class="st"> &quot;18&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;19&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;20&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;21&quot;</span>)</span>
<span id="cb21-7"><a href="time-intelligence.html#cb21-7"></a>night &lt;-<span class="st"> </span><span class="kw">filter</span> (data_hour, hour <span class="op">==</span><span class="st"> &quot;22&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;23&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;0&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;1&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;2&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;3&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;4&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;5&quot;</span>)</span>
<span id="cb21-8"><a href="time-intelligence.html#cb21-8"></a></span>
<span id="cb21-9"><a href="time-intelligence.html#cb21-9"></a><span class="co"># updating the data frames including the field season</span></span>
<span id="cb21-10"><a href="time-intelligence.html#cb21-10"></a>morning &lt;-<span class="st"> </span><span class="kw">mutate</span>(morning, <span class="dt">period =</span> <span class="st">&quot;Morning (6:00 - 9:59)&quot;</span>)</span>
<span id="cb21-11"><a href="time-intelligence.html#cb21-11"></a>mid_morning &lt;-<span class="st"> </span><span class="kw">mutate</span>(mid_morning,<span class="dt">period =</span> <span class="st">&quot;Mid-morning (10:00 - 11:59)&quot;</span>)</span>
<span id="cb21-12"><a href="time-intelligence.html#cb21-12"></a>noon &lt;-<span class="st"> </span><span class="kw">mutate</span>(noon,<span class="dt">period =</span> <span class="st">&quot;Noon (12:00 - 13:59)&quot;</span>)</span>
<span id="cb21-13"><a href="time-intelligence.html#cb21-13"></a>afternoon &lt;-<span class="st"> </span><span class="kw">mutate</span>(afternoon, <span class="dt">period =</span> <span class="st">&quot;Afternoon (14:00 - 17:59)&quot;</span>)</span>
<span id="cb21-14"><a href="time-intelligence.html#cb21-14"></a>evening &lt;-<span class="st"> </span><span class="kw">mutate</span>(evening, <span class="dt">period =</span> <span class="st">&quot;Evening (18:00 - 21:59)&quot;</span>)</span>
<span id="cb21-15"><a href="time-intelligence.html#cb21-15"></a>night &lt;-<span class="st"> </span><span class="kw">mutate</span>(night, <span class="dt">period =</span> <span class="st">&quot;Night (22:00 - 5:59)&quot;</span>)</span>
<span id="cb21-16"><a href="time-intelligence.html#cb21-16"></a></span>
<span id="cb21-17"><a href="time-intelligence.html#cb21-17"></a><span class="co">## concatenate</span></span>
<span id="cb21-18"><a href="time-intelligence.html#cb21-18"></a>data_hour_period &lt;-<span class="st"> </span><span class="kw">full_join</span>(morning, mid_morning, <span class="dt">by =</span> <span class="ot">NULL</span>, <span class="dt">copy =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## Joining, by = c(&quot;pid&quot;, &quot;name&quot;, &quot;year&quot;, &quot;hour&quot;, &quot;avg_visits&quot;, &quot;total_visits_year&quot;, &quot;pct&quot;, &quot;period&quot;)</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="time-intelligence.html#cb23-1"></a>data_hour_period2 &lt;-<span class="st"> </span><span class="kw">full_join</span>(data_hour_period, noon, <span class="dt">by =</span> <span class="ot">NULL</span>, <span class="dt">copy =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## Joining, by = c(&quot;pid&quot;, &quot;name&quot;, &quot;year&quot;, &quot;hour&quot;, &quot;avg_visits&quot;, &quot;total_visits_year&quot;, &quot;pct&quot;, &quot;period&quot;)</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="time-intelligence.html#cb25-1"></a>data_hour_period3 &lt;-<span class="st"> </span><span class="kw">full_join</span>(data_hour_period2, afternoon, <span class="dt">by =</span> <span class="ot">NULL</span>, <span class="dt">copy =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## Joining, by = c(&quot;pid&quot;, &quot;name&quot;, &quot;year&quot;, &quot;hour&quot;, &quot;avg_visits&quot;, &quot;total_visits_year&quot;, &quot;pct&quot;, &quot;period&quot;)</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="time-intelligence.html#cb27-1"></a>data_hour_period4 &lt;-<span class="st"> </span><span class="kw">full_join</span>(data_hour_period3, evening, <span class="dt">by =</span> <span class="ot">NULL</span>, <span class="dt">copy =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## Joining, by = c(&quot;pid&quot;, &quot;name&quot;, &quot;year&quot;, &quot;hour&quot;, &quot;avg_visits&quot;, &quot;total_visits_year&quot;, &quot;pct&quot;, &quot;period&quot;)</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="time-intelligence.html#cb29-1"></a>data_hour_period5 &lt;-<span class="st"> </span><span class="kw">full_join</span>(data_hour_period4, night, <span class="dt">by =</span> <span class="ot">NULL</span>, <span class="dt">copy =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## Joining, by = c(&quot;pid&quot;, &quot;name&quot;, &quot;year&quot;, &quot;hour&quot;, &quot;avg_visits&quot;, &quot;total_visits_year&quot;, &quot;pct&quot;, &quot;period&quot;)</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="time-intelligence.html#cb31-1"></a>data_hour &lt;-<span class="st"> </span>data_hour_period5 <span class="op">%&gt;%</span></span>
<span id="cb31-2"><a href="time-intelligence.html#cb31-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">period =</span> <span class="kw">fct_relevel</span>(period, </span>
<span id="cb31-3"><a href="time-intelligence.html#cb31-3"></a>                              <span class="st">&quot;Morning (6:00 - 9:59)&quot;</span>, <span class="st">&quot;Mid-morning (10:00 - 11:59)&quot;</span>, <span class="st">&quot;Noon (12:00 - 13:59)&quot;</span>, </span>
<span id="cb31-4"><a href="time-intelligence.html#cb31-4"></a>                              <span class="st">&quot;Afternoon (14:00 - 17:59)&quot;</span>, <span class="st">&quot;Evening (18:00 - 21:59)&quot;</span>, <span class="st">&quot;Night (22:00 - 5:59)&quot;</span>))  </span>
<span id="cb31-5"><a href="time-intelligence.html#cb31-5"></a></span>
<span id="cb31-6"><a href="time-intelligence.html#cb31-6"></a></span>
<span id="cb31-7"><a href="time-intelligence.html#cb31-7"></a></span>
<span id="cb31-8"><a href="time-intelligence.html#cb31-8"></a>data_hour &lt;-<span class="st"> </span>data_hour <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb31-9"><a href="time-intelligence.html#cb31-9"></a><span class="st">  </span><span class="kw">group_by</span>(year, period) <span class="op">%&gt;%</span></span>
<span id="cb31-10"><a href="time-intelligence.html#cb31-10"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">pct =</span> <span class="kw">sum</span>(pct)) </span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="time-intelligence.html#cb33-1"></a>g14 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data_hour, <span class="kw">aes</span>(<span class="dt">fill=</span> period, <span class="dt">y=</span> pct,  <span class="dt">x=</span> year)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb33-2"><a href="time-intelligence.html#cb33-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="st">&quot;dodge&quot;</span>, <span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;blue4&quot;</span>) <span class="op">+</span></span>
<span id="cb33-3"><a href="time-intelligence.html#cb33-3"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> scales<span class="op">::</span><span class="kw">percent</span>((pct),.<span class="dv">2</span>),</span>
<span id="cb33-4"><a href="time-intelligence.html#cb33-4"></a>                <span class="dt">y =</span> pct, </span>
<span id="cb33-5"><a href="time-intelligence.html#cb33-5"></a>                <span class="dt">group =</span> year,),</span>
<span id="cb33-6"><a href="time-intelligence.html#cb33-6"></a>            <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">0.9</span>),</span>
<span id="cb33-7"><a href="time-intelligence.html#cb33-7"></a>            <span class="dt">vjust =</span> <span class="fl">1.5</span>,</span>
<span id="cb33-8"><a href="time-intelligence.html#cb33-8"></a>            <span class="dt">colour=</span><span class="st">&quot;white&quot;</span>,</span>
<span id="cb33-9"><a href="time-intelligence.html#cb33-9"></a>            <span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb33-10"><a href="time-intelligence.html#cb33-10"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>period) <span class="op">+</span></span>
<span id="cb33-11"><a href="time-intelligence.html#cb33-11"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;none&quot;</span>) <span class="op">+</span></span>
<span id="cb33-12"><a href="time-intelligence.html#cb33-12"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels=</span>percent) <span class="op">+</span></span>
<span id="cb33-13"><a href="time-intelligence.html#cb33-13"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;perc.(%)&quot;</span>, </span>
<span id="cb33-14"><a href="time-intelligence.html#cb33-14"></a>       <span class="dt">x =</span> <span class="st">&quot;year&quot;</span>, </span>
<span id="cb33-15"><a href="time-intelligence.html#cb33-15"></a>       <span class="dt">title=</span><span class="st">&quot;Daily period ranges&quot;</span>, </span>
<span id="cb33-16"><a href="time-intelligence.html#cb33-16"></a>       <span class="dt">caption =</span> <span class="st">&quot;Source: Visitor Insights&quot;</span>)</span>
<span id="cb33-17"><a href="time-intelligence.html#cb33-17"></a></span>
<span id="cb33-18"><a href="time-intelligence.html#cb33-18"></a><span class="kw">plot</span>(g14)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-14-2.png" width="672" /></p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>A full descrition of the package is available at <a href="https://plotly.com/r/">https://plotly.com/r/</a><a href="time-intelligence.html#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="getting-started.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="visitor-behaviour.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
