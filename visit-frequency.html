<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Visit Frequency | Understanding Visitors with Social and Geographic Datasets: a tutorial book for local authorities, real estate and retail</title>
  <meta name="description" content="2 Visit Frequency | Understanding Visitors with Social and Geographic Datasets: a tutorial book for local authorities, real estate and retail" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Visit Frequency | Understanding Visitors with Social and Geographic Datasets: a tutorial book for local authorities, real estate and retail" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twittunner:card" content="summary" />
  <meta name="twitter:title" content="2 Visit Frequency | Understanding Visitors with Social and Geographic Datasets: a tutorial book for local authorities, real estate and retail" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introduction.html"/>
<link rel="next" href="visitor-behaviour.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.2/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.2.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#conventions"><i class="fa fa-check"></i>Conventions</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#online-version"><i class="fa fa-check"></i>Online Version</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-author"><i class="fa fa-check"></i>About the Author</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#location-technologies"><i class="fa fa-check"></i><b>1.1</b> Location Technologies</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#vi-data-infrastructure"><i class="fa fa-check"></i><b>1.2</b> VI Data Infrastructure</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#privacy-compliant-data-collection-and-use"><i class="fa fa-check"></i><b>1.3</b> Privacy-compliant data collection and use</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#representing-and-working-with-data"><i class="fa fa-check"></i><b>1.4</b> Representing and Working with Data</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="visit-frequency.html"><a href="visit-frequency.html"><i class="fa fa-check"></i><b>2</b> Visit Frequency</a><ul>
<li class="chapter" data-level="2.1" data-path="visit-frequency.html"><a href="visit-frequency.html#monthly-visits"><i class="fa fa-check"></i><b>2.1</b> Monthly Visits</a></li>
<li class="chapter" data-level="2.2" data-path="visit-frequency.html"><a href="visit-frequency.html#visits-by-day"><i class="fa fa-check"></i><b>2.2</b> Visits by Day</a></li>
<li class="chapter" data-level="2.3" data-path="visit-frequency.html"><a href="visit-frequency.html#visits-by-time-intervals"><i class="fa fa-check"></i><b>2.3</b> Visits by Time Intervals</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="visitor-behaviour.html"><a href="visitor-behaviour.html"><i class="fa fa-check"></i><b>3</b> Visitor Behaviour</a><ul>
<li class="chapter" data-level="3.1" data-path="visitor-behaviour.html"><a href="visitor-behaviour.html#visit-dwell-time"><i class="fa fa-check"></i><b>3.1</b> Visit Dwell Time</a></li>
<li class="chapter" data-level="3.2" data-path="visitor-behaviour.html"><a href="visitor-behaviour.html#visit-frequency-1"><i class="fa fa-check"></i><b>3.2</b> Visit Frequency</a></li>
<li class="chapter" data-level="3.3" data-path="visitor-behaviour.html"><a href="visitor-behaviour.html#number-of-indoor-locations-visited-per-trip"><i class="fa fa-check"></i><b>3.3</b> Number of indoor locations visited per trip</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="visitor-profile.html"><a href="visitor-profile.html"><i class="fa fa-check"></i><b>4</b> Visitor Profile</a><ul>
<li class="chapter" data-level="4.1" data-path="visitor-profile.html"><a href="visitor-profile.html#age-distribution"><i class="fa fa-check"></i><b>4.1</b> Age Distribution</a></li>
<li class="chapter" data-level="4.2" data-path="visitor-profile.html"><a href="visitor-profile.html#visitor-s-origin"><i class="fa fa-check"></i><b>4.2</b> Visitorâ€™ s Origin</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="geospatial-analysis.html"><a href="geospatial-analysis.html"><i class="fa fa-check"></i><b>5</b> Geospatial Analysis</a></li>
<li class="chapter" data-level="6" data-path="competition.html"><a href="competition.html"><i class="fa fa-check"></i><b>6</b> Competition</a></li>
<li class="chapter" data-level="7" data-path="location-portfolio-analysis.html"><a href="location-portfolio-analysis.html"><i class="fa fa-check"></i><b>7</b> Location Portfolio Analysis</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Understanding Visitors with Social and Geographic Datasets: a tutorial book for local authorities, real estate and retail</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="visit-frequency" class="section level1">
<h1><span class="header-section-number">2</span> Visit Frequency</h1>
<hr />
<p>To examine how data vary in time, It is important to explore its general characteristics. The first step prior to any command is to load the data to the space environement and to install some required packages. An R <em>package</em> is a collection of functions, data and documentations. To install an R package, you might use a single line of code:</p>
<p><code>install.packages ("package")</code></p>
<p>You must type that line of code in the console and then press <code>ENTER</code> to run it. R will download the packages from a collection of short programming repository known as <em>CRAN</em> (Comprehensive R Archive Network) and install them onto your computer.</p>
<p>Once the package is installed, you can load it with <code>library()</code> function.</p>
<p>CRAN also provides access to documentation on R, existing mailing lists and the <em>R Bug Tracking system</em>. The basic information about a package is provided in the description file, where you can find out what the package does, who the author is, what version the documentation belongs to, the date, the type of license its use, and the package dependencies. You can also access the description file inside R with the command <code>packageDescription("package")</code>, via the documentation of the package <code>help(package = "package")</code>, or online in the repository of the package.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="visit-frequency.html#cb2-1"></a><span class="co"># install if necessary using &#39;install.packages&#39;</span></span>
<span id="cb2-2"><a href="visit-frequency.html#cb2-2"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb2-3"><a href="visit-frequency.html#cb2-3"></a><span class="kw">library</span>(lubridate)</span>
<span id="cb2-4"><a href="visit-frequency.html#cb2-4"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb2-5"><a href="visit-frequency.html#cb2-5"></a><span class="kw">library</span>(plotly)</span>
<span id="cb2-6"><a href="visit-frequency.html#cb2-6"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb2-7"><a href="visit-frequency.html#cb2-7"></a><span class="kw">library</span>(scales)</span>
<span id="cb2-8"><a href="visit-frequency.html#cb2-8"></a><span class="kw">library</span>(pipeR)</span>
<span id="cb2-9"><a href="visit-frequency.html#cb2-9"></a><span class="kw">library</span>(CGPfunctions)</span>
<span id="cb2-10"><a href="visit-frequency.html#cb2-10"></a></span>
<span id="cb2-11"><a href="visit-frequency.html#cb2-11"></a></span>
<span id="cb2-12"><a href="visit-frequency.html#cb2-12"></a><span class="co"># load the data provided with the command read()</span></span>
<span id="cb2-13"><a href="visit-frequency.html#cb2-13"></a>data_monthly &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;c:/data/monthly_visits.csv&quot;</span>, <span class="dt">header=</span><span class="ot">TRUE</span>, <span class="dt">fileEncoding=</span><span class="st">&quot;UTF-8-BOM&quot;</span>)</span></code></pre></div>
<p>To transform the content of the field <em>month</em> to format <em>date</em> we use the function <code>mutate()</code>. Dates in R are numeric vectors that represent the number of days since 1 January 1970.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="visit-frequency.html#cb3-1"></a>data_monthly &lt;-<span class="st"> </span>data_monthly <span class="op">%&gt;%</span></span>
<span id="cb3-2"><a href="visit-frequency.html#cb3-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">month =</span> <span class="kw">as.Date</span>(month)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-3"><a href="visit-frequency.html#cb3-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">as.character</span>(year))</span>
<span id="cb3-4"><a href="visit-frequency.html#cb3-4"></a></span>
<span id="cb3-5"><a href="visit-frequency.html#cb3-5"></a><span class="kw">options</span>(<span class="dt">digits=</span><span class="dv">2</span>) <span class="co"># controls the number of digits of numeric values</span></span></code></pre></div>
<p>When youâ€™re looking at many data frame, it is good practice to see its content and extract a summary statistic with the distribution of the data.</p>
<p>The <code>head()</code> function in R is used to display the first <em>n</em> rows present in the input data frame.</p>
<p>You can then produce stratified summary statistics with the function <code>summary()</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="visit-frequency.html#cb4-1"></a><span class="kw">head</span>(data_monthly) <span class="co"># displays the first lines of a data frame</span></span></code></pre></div>
<pre><code>##                       name      month    pid  visits year  mm
## 1 Training Shopping Centre 2017-01-01 100001 1715887 2017 Jan
## 2 Training Shopping Centre 2017-02-01 100001 1606814 2017 Feb
## 3 Training Shopping Centre 2017-03-01 100001 1662214 2017 Mar
## 4 Training Shopping Centre 2017-04-01 100001 1603849 2017 Apr
## 5 Training Shopping Centre 2017-05-01 100001 1769676 2017 May
## 6 Training Shopping Centre 2017-06-01 100001 1684730 2017 Jun</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="visit-frequency.html#cb6-1"></a><span class="kw">summary</span>(data_monthly) <span class="co"># presents a summary of the data</span></span></code></pre></div>
<pre><code>##      name               month                 pid            visits       
##  Length:54          Min.   :2017-01-01   Min.   :1e+05   Min.   : 342593  
##  Class :character   1st Qu.:2018-02-08   1st Qu.:1e+05   1st Qu.:1604309  
##  Mode  :character   Median :2019-03-16   Median :1e+05   Median :1670654  
##                     Mean   :2019-03-17   Mean   :1e+05   Mean   :1578285  
##                     3rd Qu.:2020-04-23   3rd Qu.:1e+05   3rd Qu.:1737302  
##                     Max.   :2021-06-01   Max.   :1e+05   Max.   :2151060  
##      year                mm           
##  Length:54          Length:54         
##  Class :character   Class :character  
##  Mode  :character   Mode  :character  
##                                       
##                                       
## </code></pre>
<div id="monthly-visits" class="section level2">
<h2><span class="header-section-number">2.1</span> Monthly Visits</h2>
<p>Now that we have stored the data in a consistent format we can explore its content through visualisation.</p>
<p>The first visualisation we can make is to plot the total monthly visits in a line graph.</p>
<p>To produce an interactive, publication-quality graphs, we can use the package <code>plotly()</code><a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="visit-frequency.html#cb8-1"></a>g1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span>data_monthly, <span class="kw">aes</span>(<span class="dt">x=</span>month, <span class="dt">y=</span>visits)) <span class="op">+</span></span>
<span id="cb8-2"><a href="visit-frequency.html#cb8-2"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>comma) <span class="op">+</span></span>
<span id="cb8-3"><a href="visit-frequency.html#cb8-3"></a><span class="st">  </span><span class="kw">geom_area</span>( <span class="dt">fill=</span><span class="st">&quot;#69b3a2&quot;</span>, <span class="dt">alpha=</span><span class="fl">0.4</span>) <span class="op">+</span></span>
<span id="cb8-4"><a href="visit-frequency.html#cb8-4"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color=</span><span class="st">&quot;#69b3a2&quot;</span>) <span class="op">+</span></span>
<span id="cb8-5"><a href="visit-frequency.html#cb8-5"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">2</span>, <span class="dt">colour =</span> <span class="st">&quot;azure4&quot;</span>) <span class="op">+</span></span>
<span id="cb8-6"><a href="visit-frequency.html#cb8-6"></a><span class="st">  </span><span class="kw">theme_light</span>() <span class="op">+</span></span>
<span id="cb8-7"><a href="visit-frequency.html#cb8-7"></a><span class="st">  </span><span class="kw">scale_x_date</span>(<span class="dt">labels =</span> scales<span class="op">::</span><span class="kw">label_date</span>(<span class="st">&quot;%B</span><span class="ch">\n</span><span class="st">%Y&quot;</span>))<span class="op">+</span></span>
<span id="cb8-8"><a href="visit-frequency.html#cb8-8"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y=</span><span class="st">&quot;total visits&quot;</span>, </span>
<span id="cb8-9"><a href="visit-frequency.html#cb8-9"></a>       <span class="dt">x=</span><span class="st">&quot;date&quot;</span>, </span>
<span id="cb8-10"><a href="visit-frequency.html#cb8-10"></a>       <span class="dt">title =</span> <span class="kw">paste</span>(<span class="st">&quot;Total visits by month&quot;</span>))</span>
<span id="cb8-11"><a href="visit-frequency.html#cb8-11"></a></span>
<span id="cb8-12"><a href="visit-frequency.html#cb8-12"></a><span class="kw">ggplotly</span>(g1) <span class="co"># command used to visualise the graph</span></span></code></pre></div>
<div id="htmlwidget-39fb8e182037e08d81a1" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-39fb8e182037e08d81a1">{"x":{"data":[{"x":[17167,17198,17226,17257,17287,17318,17348,17379,17410,17440,17471,17501,17532,17563,17591,17622,17652,17683,17713,17744,17775,17805,17836,17866,17897,17928,17956,17987,18017,18048,18078,18109,18140,18170,18201,18231,18262,18293,18322,18353,18383,18414,18444,18475,18506,18536,18567,18597,18628,18659,18687,18718,18748,18779,18779,18779,18748,18718,18687,18659,18628,18597,18567,18536,18506,18475,18444,18414,18383,18353,18322,18293,18262,18231,18201,18170,18140,18109,18078,18048,18017,17987,17956,17928,17897,17866,17836,17805,17775,17744,17713,17683,17652,17622,17591,17563,17532,17501,17471,17440,17410,17379,17348,17318,17287,17257,17226,17198,17167,17167],"y":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1675552,1900854,1682763,932183.4,768692.6,650214.1,2027339,970046.3,1744441,1520945,1755307,1392032,880315.1,459212,342592.9,1171877,1711889,1793054,2126618,1632105,1617888,1653831,1689760,1867891,1676112,1785042,1635897,1697083,1553490,1675617,2140461,1605688,1595413,1627995,1665757,1890274,1708760,1783344,1636038,1702490,1555064,1678991,2151060,1641409,1609592,1626082,1681012,1894138,1684730,1769676,1603849,1662214,1606814,1715887,0],"text":["month: 2017-01-01<br />visits: 1715887","month: 2017-02-01<br />visits: 1606814","month: 2017-03-01<br />visits: 1662214","month: 2017-04-01<br />visits: 1603849","month: 2017-05-01<br />visits: 1769676","month: 2017-06-01<br />visits: 1684730","month: 2017-07-01<br />visits: 1894138","month: 2017-08-01<br />visits: 1681012","month: 2017-09-01<br />visits: 1626082","month: 2017-10-01<br />visits: 1609592","month: 2017-11-01<br />visits: 1641409","month: 2017-12-01<br />visits: 2151060","month: 2018-01-01<br />visits: 1678991","month: 2018-02-01<br />visits: 1555064","month: 2018-03-01<br />visits: 1702490","month: 2018-04-01<br />visits: 1636038","month: 2018-05-01<br />visits: 1783344","month: 2018-06-01<br />visits: 1708760","month: 2018-07-01<br />visits: 1890274","month: 2018-08-01<br />visits: 1665757","month: 2018-09-01<br />visits: 1627995","month: 2018-10-01<br />visits: 1595413","month: 2018-11-01<br />visits: 1605688","month: 2018-12-01<br />visits: 2140461","month: 2019-01-01<br />visits: 1675617","month: 2019-02-01<br />visits: 1553490","month: 2019-03-01<br />visits: 1697083","month: 2019-04-01<br />visits: 1635897","month: 2019-05-01<br />visits: 1785042","month: 2019-06-01<br />visits: 1676112","month: 2019-07-01<br />visits: 1867891","month: 2019-08-01<br />visits: 1689760","month: 2019-09-01<br />visits: 1653831","month: 2019-10-01<br />visits: 1617888","month: 2019-11-01<br />visits: 1632105","month: 2019-12-01<br />visits: 2126618","month: 2020-01-01<br />visits: 1793054","month: 2020-02-01<br />visits: 1711889","month: 2020-03-01<br />visits: 1171877","month: 2020-04-01<br />visits:  342593","month: 2020-05-01<br />visits:  459212","month: 2020-06-01<br />visits:  880315","month: 2020-07-01<br />visits: 1392032","month: 2020-08-01<br />visits: 1755307","month: 2020-09-01<br />visits: 1520945","month: 2020-10-01<br />visits: 1744441","month: 2020-11-01<br />visits:  970046","month: 2020-12-01<br />visits: 2027339","month: 2021-01-01<br />visits:  650214","month: 2021-02-01<br />visits:  768693","month: 2021-03-01<br />visits:  932183","month: 2021-04-01<br />visits: 1682763","month: 2021-05-01<br />visits: 1900854","month: 2021-06-01<br />visits: 1675552","month: 2021-06-01<br />visits: 1675552","month: 2021-06-01<br />visits: 1675552","month: 2021-05-01<br />visits: 1900854","month: 2021-04-01<br />visits: 1682763","month: 2021-03-01<br />visits:  932183","month: 2021-02-01<br />visits:  768693","month: 2021-01-01<br />visits:  650214","month: 2020-12-01<br />visits: 2027339","month: 2020-11-01<br />visits:  970046","month: 2020-10-01<br />visits: 1744441","month: 2020-09-01<br />visits: 1520945","month: 2020-08-01<br />visits: 1755307","month: 2020-07-01<br />visits: 1392032","month: 2020-06-01<br />visits:  880315","month: 2020-05-01<br />visits:  459212","month: 2020-04-01<br />visits:  342593","month: 2020-03-01<br />visits: 1171877","month: 2020-02-01<br />visits: 1711889","month: 2020-01-01<br />visits: 1793054","month: 2019-12-01<br />visits: 2126618","month: 2019-11-01<br />visits: 1632105","month: 2019-10-01<br />visits: 1617888","month: 2019-09-01<br />visits: 1653831","month: 2019-08-01<br />visits: 1689760","month: 2019-07-01<br />visits: 1867891","month: 2019-06-01<br />visits: 1676112","month: 2019-05-01<br />visits: 1785042","month: 2019-04-01<br />visits: 1635897","month: 2019-03-01<br />visits: 1697083","month: 2019-02-01<br />visits: 1553490","month: 2019-01-01<br />visits: 1675617","month: 2018-12-01<br />visits: 2140461","month: 2018-11-01<br />visits: 1605688","month: 2018-10-01<br />visits: 1595413","month: 2018-09-01<br />visits: 1627995","month: 2018-08-01<br />visits: 1665757","month: 2018-07-01<br />visits: 1890274","month: 2018-06-01<br />visits: 1708760","month: 2018-05-01<br />visits: 1783344","month: 2018-04-01<br />visits: 1636038","month: 2018-03-01<br />visits: 1702490","month: 2018-02-01<br />visits: 1555064","month: 2018-01-01<br />visits: 1678991","month: 2017-12-01<br />visits: 2151060","month: 2017-11-01<br />visits: 1641409","month: 2017-10-01<br />visits: 1609592","month: 2017-09-01<br />visits: 1626082","month: 2017-08-01<br />visits: 1681012","month: 2017-07-01<br />visits: 1894138","month: 2017-06-01<br />visits: 1684730","month: 2017-05-01<br />visits: 1769676","month: 2017-04-01<br />visits: 1603849","month: 2017-03-01<br />visits: 1662214","month: 2017-02-01<br />visits: 1606814","month: 2017-01-01<br />visits: 1715887","month: 2017-01-01<br />visits: 1715887"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"transparent","dash":"solid"},"fill":"toself","fillcolor":"rgba(105,179,162,0.4)","hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[17167,17198,17226,17257,17287,17318,17348,17379,17410,17440,17471,17501,17532,17563,17591,17622,17652,17683,17713,17744,17775,17805,17836,17866,17897,17928,17956,17987,18017,18048,18078,18109,18140,18170,18201,18231,18262,18293,18322,18353,18383,18414,18444,18475,18506,18536,18567,18597,18628,18659,18687,18718,18748,18779],"y":[1715887,1606814,1662214,1603849,1769676,1684730,1894138,1681012,1626082,1609592,1641409,2151060,1678991,1555064,1702490,1636038,1783344,1708760,1890274,1665757,1627995,1595413,1605688,2140461,1675617,1553490,1697083,1635897,1785042,1676112,1867891,1689760,1653831,1617888,1632105,2126618,1793054,1711889,1171877,342592.9,459212,880315.1,1392032,1755307,1520945,1744441,970046.3,2027339,650214.1,768692.6,932183.4,1682763,1900854,1675552],"text":["month: 2017-01-01<br />visits: 1715887","month: 2017-02-01<br />visits: 1606814","month: 2017-03-01<br />visits: 1662214","month: 2017-04-01<br />visits: 1603849","month: 2017-05-01<br />visits: 1769676","month: 2017-06-01<br />visits: 1684730","month: 2017-07-01<br />visits: 1894138","month: 2017-08-01<br />visits: 1681012","month: 2017-09-01<br />visits: 1626082","month: 2017-10-01<br />visits: 1609592","month: 2017-11-01<br />visits: 1641409","month: 2017-12-01<br />visits: 2151060","month: 2018-01-01<br />visits: 1678991","month: 2018-02-01<br />visits: 1555064","month: 2018-03-01<br />visits: 1702490","month: 2018-04-01<br />visits: 1636038","month: 2018-05-01<br />visits: 1783344","month: 2018-06-01<br />visits: 1708760","month: 2018-07-01<br />visits: 1890274","month: 2018-08-01<br />visits: 1665757","month: 2018-09-01<br />visits: 1627995","month: 2018-10-01<br />visits: 1595413","month: 2018-11-01<br />visits: 1605688","month: 2018-12-01<br />visits: 2140461","month: 2019-01-01<br />visits: 1675617","month: 2019-02-01<br />visits: 1553490","month: 2019-03-01<br />visits: 1697083","month: 2019-04-01<br />visits: 1635897","month: 2019-05-01<br />visits: 1785042","month: 2019-06-01<br />visits: 1676112","month: 2019-07-01<br />visits: 1867891","month: 2019-08-01<br />visits: 1689760","month: 2019-09-01<br />visits: 1653831","month: 2019-10-01<br />visits: 1617888","month: 2019-11-01<br />visits: 1632105","month: 2019-12-01<br />visits: 2126618","month: 2020-01-01<br />visits: 1793054","month: 2020-02-01<br />visits: 1711889","month: 2020-03-01<br />visits: 1171877","month: 2020-04-01<br />visits:  342593","month: 2020-05-01<br />visits:  459212","month: 2020-06-01<br />visits:  880315","month: 2020-07-01<br />visits: 1392032","month: 2020-08-01<br />visits: 1755307","month: 2020-09-01<br />visits: 1520945","month: 2020-10-01<br />visits: 1744441","month: 2020-11-01<br />visits:  970046","month: 2020-12-01<br />visits: 2027339","month: 2021-01-01<br />visits:  650214","month: 2021-02-01<br />visits:  768693","month: 2021-03-01<br />visits:  932183","month: 2021-04-01<br />visits: 1682763","month: 2021-05-01<br />visits: 1900854","month: 2021-06-01<br />visits: 1675552"],"type":"scatter","mode":"lines+markers","line":{"width":1.88976377952756,"color":"rgba(105,179,162,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","marker":{"autocolorscale":false,"color":"rgba(131,139,139,1)","opacity":1,"size":7.55905511811024,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(131,139,139,1)"}},"frame":null}],"layout":{"margin":{"t":43.7625570776256,"r":7.30593607305936,"b":40.1826484018265,"l":78.1735159817352},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"title":{"text":"Total visits by month","font":{"color":"rgba(0,0,0,1)","family":"","size":17.5342465753425},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[17086.4,18859.6],"tickmode":"array","ticktext":["January<br />2017","January<br />2018","January<br />2019","January<br />2020","January<br />2021"],"tickvals":[17167,17532,17897,18262,18628],"categoryorder":"array","categoryarray":["January<br />2017","January<br />2018","January<br />2019","January<br />2020","January<br />2021"],"nticks":null,"ticks":"outside","tickcolor":"rgba(179,179,179,1)","ticklen":3.65296803652968,"tickwidth":0.33208800332088,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(222,222,222,1)","gridwidth":0.33208800332088,"zeroline":false,"anchor":"y","title":{"text":"date","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-107553,2258613],"tickmode":"array","ticktext":["0","500,000","1,000,000","1,500,000","2,000,000"],"tickvals":[0,500000,1000000,1500000,2000000],"categoryorder":"array","categoryarray":["0","500,000","1,000,000","1,500,000","2,000,000"],"nticks":null,"ticks":"outside","tickcolor":"rgba(179,179,179,1)","ticklen":3.65296803652968,"tickwidth":0.33208800332088,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(222,222,222,1)","gridwidth":0.33208800332088,"zeroline":false,"anchor":"x","title":{"text":"total visits","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(179,179,179,1)","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"2c103f385c08":{"x":{},"y":{},"type":"scatter"},"2c101fa92efc":{"x":{},"y":{}},"2c1061d029e7":{"x":{},"y":{}}},"cur_data":"2c103f385c08","visdat":{"2c103f385c08":["function (y) ","x"],"2c101fa92efc":["function (y) ","x"],"2c1061d029e7":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>Instead of generating an interactive graph, we can also drawn a graph with additional elements like annotations and caption information like the source of data.</p>
<p>In this example, you can see that we use the same package <code>ggplot2()</code> to set up the graph. An annotation lable displays in the graph the initial enforced lockdown in the UK in 2020.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="visit-frequency.html#cb9-1"></a>g2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data_monthly, <span class="kw">aes</span>(month, visits)) <span class="op">+</span></span>
<span id="cb9-2"><a href="visit-frequency.html#cb9-2"></a><span class="st">  </span><span class="kw">scale_x_date</span>(<span class="dt">labels =</span> scales<span class="op">::</span><span class="kw">label_date</span>(<span class="st">&quot;%B</span><span class="ch">\n</span><span class="st">%Y&quot;</span>)) <span class="op">+</span></span>
<span id="cb9-3"><a href="visit-frequency.html#cb9-3"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>comma)<span class="op">+</span></span>
<span id="cb9-4"><a href="visit-frequency.html#cb9-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">colour =</span> <span class="st">&quot;blue&quot;</span> ,</span>
<span id="cb9-5"><a href="visit-frequency.html#cb9-5"></a>             <span class="dt">size =</span> <span class="dv">3</span>, </span>
<span id="cb9-6"><a href="visit-frequency.html#cb9-6"></a>             <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">+</span></span>
<span id="cb9-7"><a href="visit-frequency.html#cb9-7"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">na.rm =</span> <span class="ot">TRUE</span>,</span>
<span id="cb9-8"><a href="visit-frequency.html#cb9-8"></a>            <span class="dt">colour =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span></span>
<span id="cb9-9"><a href="visit-frequency.html#cb9-9"></a><span class="st">  </span><span class="kw">annotate</span>(</span>
<span id="cb9-10"><a href="visit-frequency.html#cb9-10"></a>    <span class="dt">geom =</span> <span class="st">&quot;segment&quot;</span>, <span class="dt">x =</span> <span class="kw">ymd</span>(<span class="st">&quot;2020-03-23&quot;</span>), <span class="dt">y =</span> <span class="dv">2000000</span>, <span class="dt">xend =</span> <span class="kw">ymd</span>(<span class="st">&quot;2020-03-23&quot;</span>), <span class="dt">yend =</span> <span class="dv">1800000</span>, </span>
<span id="cb9-11"><a href="visit-frequency.html#cb9-11"></a>    <span class="dt">arrow =</span> <span class="kw">arrow</span>(<span class="dt">length =</span> <span class="kw">unit</span>(<span class="dv">2</span>, <span class="st">&quot;mm&quot;</span>))</span>
<span id="cb9-12"><a href="visit-frequency.html#cb9-12"></a>  ) <span class="op">+</span></span>
<span id="cb9-13"><a href="visit-frequency.html#cb9-13"></a><span class="st">  </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="kw">ymd</span>(<span class="st">&quot;2020-03-12&quot;</span>), <span class="dt">y =</span> <span class="dv">2150000</span>,  <span class="dt">label =</span> <span class="st">&quot;lockdown</span><span class="ch">\n</span><span class="st">23 March 2020&quot;</span>, <span class="dt">hjust =</span> <span class="st">&quot;left&quot;</span>)</span>
<span id="cb9-14"><a href="visit-frequency.html#cb9-14"></a></span>
<span id="cb9-15"><a href="visit-frequency.html#cb9-15"></a></span>
<span id="cb9-16"><a href="visit-frequency.html#cb9-16"></a>g2 <span class="op">+</span></span>
<span id="cb9-17"><a href="visit-frequency.html#cb9-17"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">y=</span><span class="st">&quot;total visits&quot;</span>, </span>
<span id="cb9-18"><a href="visit-frequency.html#cb9-18"></a>       <span class="dt">x=</span><span class="st">&quot;date&quot;</span>, </span>
<span id="cb9-19"><a href="visit-frequency.html#cb9-19"></a>       <span class="dt">title =</span> <span class="kw">paste</span>(<span class="st">&quot;Total visits by month&quot;</span>),</span>
<span id="cb9-20"><a href="visit-frequency.html#cb9-20"></a>       <span class="dt">caption =</span> <span class="st">&quot;Source: Visitor Insights&quot;</span>)</span></code></pre></div>
<p><img src="images/unnamed-chunk-7-1.png" width="672" /></p>
<p>Suppose we wish to explore the seasonality effects in the monthly visits. For instance, we know that December is the most busy time of the year for retail with Christmas and new year celebrations. We can plot the very same data in a graph transforming the x-axis to display the months instead of dates.</p>
<p>Note that we use the field <em>mm</em> to set up the graph. <code>fct_relevel()</code> is used to order the months in the correct way. A legend is also displayed setting the colours for the years.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="visit-frequency.html#cb10-1"></a><span class="co"># transform the format of the month field  </span></span>
<span id="cb10-2"><a href="visit-frequency.html#cb10-2"></a>data_monthly &lt;-<span class="st"> </span>data_monthly <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb10-3"><a href="visit-frequency.html#cb10-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mm =</span> <span class="kw">fct_relevel</span>(mm, </span>
<span id="cb10-4"><a href="visit-frequency.html#cb10-4"></a>                          <span class="st">&quot;Jan&quot;</span>, <span class="st">&quot;Feb&quot;</span>, <span class="st">&quot;Mar&quot;</span>,<span class="st">&quot;Apr&quot;</span>, <span class="st">&quot;May&quot;</span>, <span class="st">&quot;Jun&quot;</span>, </span>
<span id="cb10-5"><a href="visit-frequency.html#cb10-5"></a>                          <span class="st">&quot;Jul&quot;</span>, <span class="st">&quot;Aug&quot;</span>, <span class="st">&quot;Sep&quot;</span>, <span class="st">&quot;Oct&quot;</span>, <span class="st">&quot;Nov&quot;</span>, <span class="st">&quot;Dec&quot;</span>)) </span>
<span id="cb10-6"><a href="visit-frequency.html#cb10-6"></a></span>
<span id="cb10-7"><a href="visit-frequency.html#cb10-7"></a></span>
<span id="cb10-8"><a href="visit-frequency.html#cb10-8"></a>g3 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data_monthly, <span class="kw">aes</span>(mm, visits, <span class="dt">color =</span> year)) <span class="op">+</span></span>
<span id="cb10-9"><a href="visit-frequency.html#cb10-9"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>comma) <span class="op">+</span></span>
<span id="cb10-10"><a href="visit-frequency.html#cb10-10"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> year), <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb10-11"><a href="visit-frequency.html#cb10-11"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">group =</span> year), <span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb10-12"><a href="visit-frequency.html#cb10-12"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="st">&#39;Program Type&#39;</span>)</span>
<span id="cb10-13"><a href="visit-frequency.html#cb10-13"></a></span>
<span id="cb10-14"><a href="visit-frequency.html#cb10-14"></a>g3 <span class="op">+</span></span>
<span id="cb10-15"><a href="visit-frequency.html#cb10-15"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="op">+</span></span>
<span id="cb10-16"><a href="visit-frequency.html#cb10-16"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y=</span><span class="st">&quot;total visits&quot;</span>, </span>
<span id="cb10-17"><a href="visit-frequency.html#cb10-17"></a>       <span class="dt">x=</span><span class="st">&quot;month&quot;</span>, </span>
<span id="cb10-18"><a href="visit-frequency.html#cb10-18"></a>       <span class="dt">title =</span> <span class="kw">paste</span>(<span class="st">&quot;Total visits by month&quot;</span>),</span>
<span id="cb10-19"><a href="visit-frequency.html#cb10-19"></a>       <span class="dt">caption =</span> <span class="st">&quot;Source: Visitor Insights&quot;</span>)</span></code></pre></div>
<p><img src="images/unnamed-chunk-8-1.png" width="672" /></p>
<p>Another way to explore seasonality is using <em>faceting</em>. Faceting generates small multiples each showing a different subset of the data, for example the years in a table. It is a powerful tool for exploratory data analysis: you can rapidly compare patterns in different parts of the data and see whether they are the same or different.</p>
<p><code>facet_wrap()</code> makes a ribbon of panels (generated by any number of variables) and wraps it into 2d. In the example below we set up a faceting graph arranging each panel to display the data for a particular year.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="visit-frequency.html#cb11-1"></a>g4  &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data_monthly, <span class="kw">aes</span>(mm, visits, <span class="dt">color =</span> year)) <span class="op">+</span></span>
<span id="cb11-2"><a href="visit-frequency.html#cb11-2"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>comma) <span class="op">+</span></span>
<span id="cb11-3"><a href="visit-frequency.html#cb11-3"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> year), <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb11-4"><a href="visit-frequency.html#cb11-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">group =</span> year), <span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb11-5"><a href="visit-frequency.html#cb11-5"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="st">&#39;Program Type&#39;</span>) <span class="op">+</span></span>
<span id="cb11-6"><a href="visit-frequency.html#cb11-6"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>year,<span class="dt">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb11-7"><a href="visit-frequency.html#cb11-7"></a></span>
<span id="cb11-8"><a href="visit-frequency.html#cb11-8"></a>g4 <span class="op">+</span></span>
<span id="cb11-9"><a href="visit-frequency.html#cb11-9"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), <span class="dt">legend.justification =</span> <span class="kw">c</span>(<span class="fl">2.5</span>, <span class="dv">0</span>)) <span class="op">+</span></span>
<span id="cb11-10"><a href="visit-frequency.html#cb11-10"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">-90</span>, <span class="dt">vjust =</span> <span class="fl">0.5</span>)) <span class="op">+</span></span>
<span id="cb11-11"><a href="visit-frequency.html#cb11-11"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y=</span><span class="st">&quot;total visits&quot;</span>, </span>
<span id="cb11-12"><a href="visit-frequency.html#cb11-12"></a>       <span class="dt">x=</span><span class="st">&quot;month&quot;</span>, </span>
<span id="cb11-13"><a href="visit-frequency.html#cb11-13"></a>       <span class="dt">title =</span> <span class="kw">paste</span>(<span class="st">&quot;Total visits by month&quot;</span>),</span>
<span id="cb11-14"><a href="visit-frequency.html#cb11-14"></a>       <span class="dt">caption =</span> <span class="st">&quot;Source: Visitor Insights&quot;</span>)</span></code></pre></div>
<p><img src="images/unnamed-chunk-9-1.png" width="672" /></p>
<p>We may also need to display a summary of total visits by year. In this example, it would make sense to display the numbers for 2017 to 2020, discarding 2021 as far as we do not have the full completed data for this year.</p>
<p>First we filter for the years with the function <code>filter()</code>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="visit-frequency.html#cb12-1"></a>data_year &lt;-<span class="st"> </span><span class="kw">select</span>(data_monthly, year, visits) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-2"><a href="visit-frequency.html#cb12-2"></a><span class="st">  </span><span class="kw">filter</span> (year <span class="op">==</span><span class="st"> &quot;2017&quot;</span><span class="op">|</span><span class="st"> </span>year <span class="op">==</span><span class="st"> &quot;2018&quot;</span> <span class="op">|</span><span class="st"> </span>year <span class="op">==</span><span class="st"> &quot;2019&quot;</span> <span class="op">|</span><span class="st"> </span>year <span class="op">==</span><span class="st"> &quot;2020&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-3"><a href="visit-frequency.html#cb12-3"></a><span class="st">  </span><span class="kw">group_by</span>(year) <span class="op">%&gt;%</span></span>
<span id="cb12-4"><a href="visit-frequency.html#cb12-4"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">visits =</span>  <span class="kw">sum</span>(visits))</span></code></pre></div>
<p>We can than set up and display the graph.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="visit-frequency.html#cb13-1"></a>g5 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data_year, <span class="kw">aes</span>(year, visits)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb13-2"><a href="visit-frequency.html#cb13-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span></span>
<span id="cb13-3"><a href="visit-frequency.html#cb13-3"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> <span class="kw">comma_format</span>(), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">22000000</span>)) <span class="op">+</span></span>
<span id="cb13-4"><a href="visit-frequency.html#cb13-4"></a><span class="st">  </span><span class="kw">theme_grey</span>()  <span class="op">+</span></span>
<span id="cb13-5"><a href="visit-frequency.html#cb13-5"></a><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">fill =</span> <span class="st">&quot;gray41&quot;</span>) <span class="op">+</span></span>
<span id="cb13-6"><a href="visit-frequency.html#cb13-6"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">y =</span> visits, <span class="dt">label =</span> scales<span class="op">::</span><span class="kw">comma</span>(<span class="kw">round</span>(visits), <span class="dt">accuracy=</span><span class="dv">1</span>)),</span>
<span id="cb13-7"><a href="visit-frequency.html#cb13-7"></a>            <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">0.9</span>),</span>
<span id="cb13-8"><a href="visit-frequency.html#cb13-8"></a>            <span class="dt">size =</span> <span class="dv">5</span>,</span>
<span id="cb13-9"><a href="visit-frequency.html#cb13-9"></a>            <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb13-10"><a href="visit-frequency.html#cb13-10"></a>            <span class="dt">vjust =</span> <span class="fl">-1.0</span>) <span class="op">+</span></span>
<span id="cb13-11"><a href="visit-frequency.html#cb13-11"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y=</span><span class="st">&quot;total visits&quot;</span>, </span>
<span id="cb13-12"><a href="visit-frequency.html#cb13-12"></a>       <span class="dt">x=</span><span class="st">&quot;year&quot;</span>, </span>
<span id="cb13-13"><a href="visit-frequency.html#cb13-13"></a>       <span class="dt">title=</span><span class="st">&quot;Total visits&quot;</span>, </span>
<span id="cb13-14"><a href="visit-frequency.html#cb13-14"></a>       <span class="dt">caption =</span> <span class="st">&quot;Source: Visitor Insights&quot;</span>) </span>
<span id="cb13-15"><a href="visit-frequency.html#cb13-15"></a></span>
<span id="cb13-16"><a href="visit-frequency.html#cb13-16"></a>g5 <span class="op">+</span></span>
<span id="cb13-17"><a href="visit-frequency.html#cb13-17"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;linen&quot;</span>)) <span class="op">+</span></span>
<span id="cb13-18"><a href="visit-frequency.html#cb13-18"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>))</span></code></pre></div>
<p><img src="images/unnamed-chunk-11-1.png" width="672" /></p>
</div>
<div id="visits-by-day" class="section level2">
<h2><span class="header-section-number">2.2</span> Visits by Day</h2>
<p>In this part, we will explore how to work with dates. The file with training data provided, <em>daily_visits.csv</em>, includes a <em>data-time</em> field: <em>day</em>. This type of data uniquely identifies an instant in time with a date plus a time.</p>
<p>With this format, we can decompose the data in particular time components: weekday, week and hour to explote the frequency of visits by different daily and time components.</p>
<p>Let begin with weekday figures.</p>
<p>First load the data provided with the command <code>read()</code> and transform the field day with <code>as.Date()</code>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="visit-frequency.html#cb14-1"></a>data_daily &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;C:/Users/Laurent/OneDrive - ROCS/VI/daily_visits.csv&quot;</span>)</span>
<span id="cb14-2"><a href="visit-frequency.html#cb14-2"></a></span>
<span id="cb14-3"><a href="visit-frequency.html#cb14-3"></a></span>
<span id="cb14-4"><a href="visit-frequency.html#cb14-4"></a>data_daily &lt;-<span class="st"> </span><span class="kw">mutate</span>(data_daily,</span>
<span id="cb14-5"><a href="visit-frequency.html#cb14-5"></a>                     <span class="dt">date =</span><span class="kw">as.Date</span>(day, <span class="dt">format=</span><span class="st">&quot;%d/%m/%Y&quot;</span>))</span></code></pre></div>
<p>To get the individual parts of a date-time field, you can apply the functions <code>year()</code>, <code>month()</code>, <code>mday()</code> (day of the month), <code>yday()</code> (day of the year), <code>wday()</code>, <code>hour()</code>, <code>minute()</code>, and <code>second()</code>.</p>
<p>In the fisrt example, we will pull-out the weekday component to explore the visit frequency by day of the week. To visualise the data, we also need to collapse the data frame to a single row: the number of visits by individual day component with the function <code>summarise()</code>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="visit-frequency.html#cb15-1"></a>data_daily &lt;-<span class="st"> </span><span class="kw">mutate</span> (data_daily, <span class="co"># getting date-time components</span></span>
<span id="cb15-2"><a href="visit-frequency.html#cb15-2"></a>                      <span class="dt">wday =</span> <span class="kw">wday</span>(date, <span class="dt">label =</span> <span class="ot">TRUE</span>), </span>
<span id="cb15-3"><a href="visit-frequency.html#cb15-3"></a>                      <span class="dt">week =</span> <span class="kw">week</span> (date), </span>
<span id="cb15-4"><a href="visit-frequency.html#cb15-4"></a>                      <span class="dt">year =</span> <span class="kw">year</span> (date),</span>
<span id="cb15-5"><a href="visit-frequency.html#cb15-5"></a>                      <span class="dt">month =</span> <span class="kw">month</span> (date), </span>
<span id="cb15-6"><a href="visit-frequency.html#cb15-6"></a>                      <span class="dt">hour =</span> <span class="kw">hour</span> (date))</span>
<span id="cb15-7"><a href="visit-frequency.html#cb15-7"></a></span>
<span id="cb15-8"><a href="visit-frequency.html#cb15-8"></a></span>
<span id="cb15-9"><a href="visit-frequency.html#cb15-9"></a></span>
<span id="cb15-10"><a href="visit-frequency.html#cb15-10"></a>data_daily &lt;-<span class="st"> </span>data_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># re-orderes the sequence of days</span></span>
<span id="cb15-11"><a href="visit-frequency.html#cb15-11"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">wday =</span> <span class="kw">fct_relevel</span>(wday, </span>
<span id="cb15-12"><a href="visit-frequency.html#cb15-12"></a>                            <span class="st">&quot;Mon&quot;</span>, <span class="st">&quot;Tue&quot;</span>, <span class="st">&quot;Wed&quot;</span>,<span class="st">&quot;Thu&quot;</span>, <span class="st">&quot;Fri&quot;</span>, <span class="st">&quot;Sat&quot;</span>, </span>
<span id="cb15-13"><a href="visit-frequency.html#cb15-13"></a>                            <span class="st">&quot;Sun&quot;</span>)) </span>
<span id="cb15-14"><a href="visit-frequency.html#cb15-14"></a></span>
<span id="cb15-15"><a href="visit-frequency.html#cb15-15"></a>data_daily_avg &lt;-<span class="st"> </span>data_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># create a new object with the average visits by day of the week</span></span>
<span id="cb15-16"><a href="visit-frequency.html#cb15-16"></a><span class="st">  </span><span class="kw">group_by</span>(wday) <span class="op">%&gt;%</span></span>
<span id="cb15-17"><a href="visit-frequency.html#cb15-17"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">visits =</span> <span class="kw">mean</span>(visits)) </span></code></pre></div>
<p>You can visualise the object <em>data_daily_avg</em> we just created using the same functions we alreay used.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="visit-frequency.html#cb16-1"></a><span class="kw">head</span>(data_daily_avg) <span class="co"># displays the first lines of a data frame</span></span></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   wday  visits
##   &lt;ord&gt;  &lt;dbl&gt;
## 1 Mon   48610.
## 2 Tue   47614.
## 3 Wed   47061.
## 4 Thu   49058.
## 5 Fri   56569.
## 6 Sat   67891.</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="visit-frequency.html#cb18-1"></a><span class="kw">summary</span>(data_daily_avg) <span class="co"># presents a summary of the data</span></span></code></pre></div>
<pre><code>##   wday       visits     
##  Mon:1   Min.   :45649  
##  Tue:1   1st Qu.:47337  
##  Wed:1   Median :48610  
##  Thu:1   Mean   :51779  
##  Fri:1   3rd Qu.:52814  
##  Sat:1   Max.   :67891  
##  Sun:1</code></pre>
<p>We can now set up the graph with the visit frequency by day of the week.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="visit-frequency.html#cb20-1"></a>g5 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data_daily_avg, <span class="kw">aes</span>(<span class="dt">x =</span> wday, <span class="dt">y =</span> visits)) <span class="op">+</span></span>
<span id="cb20-2"><a href="visit-frequency.html#cb20-2"></a><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">fill =</span> <span class="st">&quot;cyan4&quot;</span>) <span class="op">+</span></span>
<span id="cb20-3"><a href="visit-frequency.html#cb20-3"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>comma) <span class="op">+</span></span>
<span id="cb20-4"><a href="visit-frequency.html#cb20-4"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">y =</span> visits, <span class="dt">label =</span> scales<span class="op">::</span><span class="kw">comma</span>(<span class="kw">round</span>(visits), <span class="dt">accuracy=</span><span class="dv">1</span>)),</span>
<span id="cb20-5"><a href="visit-frequency.html#cb20-5"></a>            <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">0.5</span>),</span>
<span id="cb20-6"><a href="visit-frequency.html#cb20-6"></a>            <span class="dt">size =</span> <span class="fl">5.5</span>,</span>
<span id="cb20-7"><a href="visit-frequency.html#cb20-7"></a>            <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb20-8"><a href="visit-frequency.html#cb20-8"></a>            <span class="dt">vjust =</span> <span class="fl">-0.1</span>)</span>
<span id="cb20-9"><a href="visit-frequency.html#cb20-9"></a></span>
<span id="cb20-10"><a href="visit-frequency.html#cb20-10"></a>g5 <span class="op">+</span></span>
<span id="cb20-11"><a href="visit-frequency.html#cb20-11"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="dt">colour =</span> <span class="ot">NA</span>)) <span class="op">+</span></span>
<span id="cb20-12"><a href="visit-frequency.html#cb20-12"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;lightblue&quot;</span>)) <span class="op">+</span></span>
<span id="cb20-13"><a href="visit-frequency.html#cb20-13"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>)) <span class="op">+</span></span>
<span id="cb20-14"><a href="visit-frequency.html#cb20-14"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Total visits by day&quot;</span>,</span>
<span id="cb20-15"><a href="visit-frequency.html#cb20-15"></a>      <span class="dt">y=</span><span class="st">&quot;average daily visits&quot;</span>, </span>
<span id="cb20-16"><a href="visit-frequency.html#cb20-16"></a>      <span class="dt">x=</span><span class="st">&quot;day&quot;</span>,</span>
<span id="cb20-17"><a href="visit-frequency.html#cb20-17"></a>      <span class="dt">caption =</span> <span class="st">&quot;Source: Visitor Insights&quot;</span>) </span></code></pre></div>
<p><img src="images/unnamed-chunk-15-1.png" width="672" /></p>
<p>The previous graph acknowledges that Saturday is the most busey day of the week for the location we are studying. It might be helpul to understand differences that might exists in different years. Maybe the pandemic could have changed this pattern.</p>
<p>To tackle this question, we must calculated first the visit frequency by weekday and year. Again, the function <code>summarise()</code> should be used to create a new object.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="visit-frequency.html#cb21-1"></a>data_daily_avg_year &lt;-<span class="st"> </span>data_daily <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb21-2"><a href="visit-frequency.html#cb21-2"></a><span class="st">  </span><span class="kw">group_by</span>(wday, year) <span class="op">%&gt;%</span></span>
<span id="cb21-3"><a href="visit-frequency.html#cb21-3"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">visits =</span> <span class="kw">mean</span>(visits)) </span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;wday&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="visit-frequency.html#cb23-1"></a><span class="kw">head</span>(data_daily_avg_year) <span class="co"># displays the first lines of a data frame</span></span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
## # Groups:   wday [2]
##   wday   year visits
##   &lt;ord&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1 Mon    2017 50761.
## 2 Mon    2018 53289.
## 3 Mon    2019 53074.
## 4 Mon    2020 41007.
## 5 Mon    2021 41792.
## 6 Tue    2017 54327.</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="visit-frequency.html#cb25-1"></a><span class="kw">summary</span>(data_daily_avg_year) <span class="co"># presents a summary of the data</span></span></code></pre></div>
<pre><code>##   wday        year          visits     
##  Mon:5   Min.   :2017   Min.   :33967  
##  Tue:5   1st Qu.:2018   1st Qu.:41603  
##  Wed:5   Median :2019   Median :50932  
##  Thu:5   Mean   :2019   Mean   :50958  
##  Fri:5   3rd Qu.:2020   3rd Qu.:53706  
##  Sat:5   Max.   :2021   Max.   :77253  
##  Sun:5</code></pre>
<p>We now can plot the data from the object we just created.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="visit-frequency.html#cb27-1"></a>g5 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data_daily_avg_year, <span class="kw">aes</span>(<span class="dt">x =</span> wday, <span class="dt">y =</span> visits)) <span class="op">+</span></span>
<span id="cb27-2"><a href="visit-frequency.html#cb27-2"></a><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">fill =</span> <span class="st">&quot;cyan4&quot;</span>)<span class="op">+</span></span>
<span id="cb27-3"><a href="visit-frequency.html#cb27-3"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>comma) <span class="op">+</span></span>
<span id="cb27-4"><a href="visit-frequency.html#cb27-4"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> <span class="kw">round</span>(visits, <span class="dv">0</span>)), <span class="dt">vjust =</span> <span class="fl">-0.2</span>, <span class="dt">size =</span> <span class="fl">2.5</span>) <span class="op">+</span></span>
<span id="cb27-5"><a href="visit-frequency.html#cb27-5"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>year)</span>
<span id="cb27-6"><a href="visit-frequency.html#cb27-6"></a></span>
<span id="cb27-7"><a href="visit-frequency.html#cb27-7"></a></span>
<span id="cb27-8"><a href="visit-frequency.html#cb27-8"></a>g5 <span class="op">+</span></span>
<span id="cb27-9"><a href="visit-frequency.html#cb27-9"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y=</span><span class="st">&quot;average daily visits&quot;</span>, </span>
<span id="cb27-10"><a href="visit-frequency.html#cb27-10"></a>       <span class="dt">x=</span><span class="st">&quot;day&quot;</span>,</span>
<span id="cb27-11"><a href="visit-frequency.html#cb27-11"></a>       <span class="dt">caption =</span> <span class="st">&quot;Source: Visitor Insights&quot;</span>)</span></code></pre></div>
<p><img src="images/unnamed-chunk-17-1.png" width="672" /></p>
<p>Saturday is indeed the most busy day in our scheme. But note that the average daily visits has sharply decreased in 2020 and 2021. Clearly the pandemic has heavily impacted the number of visitors.</p>
<p>But remember, we are dealing with average numbers which can hide bias in the distribution of the data. That is, as a commercial property, the lockdown period lead to a very low number of visitors, <em>outlier numbers</em> from a data perspective.</p>
<p>We can explore the variation of an attribute (for example the average number of visitors) with a <em>boxplot</em>( <code>geom_boxplot()</code>). A boxplot summarises the shape of the distribution with a handful of summary statistics.</p>
<p>The boxes represent the interquartile range: 50% of the data lie in this region, and the horizontal line in the box is the median. To improve graph, we can also allow a red dot to represent the mean.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="visit-frequency.html#cb28-1"></a>g5 &lt;-<span class="st">   </span><span class="kw">ggplot</span>(data_daily, <span class="kw">aes</span>(<span class="dt">x=</span>wday,<span class="dt">y=</span>visits, <span class="dt">fill=</span>wday)) <span class="op">+</span></span>
<span id="cb28-2"><a href="visit-frequency.html#cb28-2"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>comma) <span class="op">+</span></span>
<span id="cb28-3"><a href="visit-frequency.html#cb28-3"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">outlier.shape =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb28-4"><a href="visit-frequency.html#cb28-4"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>year) <span class="op">+</span></span>
<span id="cb28-5"><a href="visit-frequency.html#cb28-5"></a><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">150000</span>)) <span class="op">+</span></span>
<span id="cb28-6"><a href="visit-frequency.html#cb28-6"></a><span class="st">  </span><span class="kw">stat_summary</span>(<span class="dt">fun =</span> mean, <span class="dt">geom=</span><span class="st">&quot;point&quot;</span>, <span class="dt">shape=</span><span class="dv">20</span>, <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb28-7"><a href="visit-frequency.html#cb28-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y=</span><span class="st">&quot;daily visits&quot;</span>, </span>
<span id="cb28-8"><a href="visit-frequency.html#cb28-8"></a>       <span class="dt">x=</span><span class="st">&quot;day&quot;</span>, </span>
<span id="cb28-9"><a href="visit-frequency.html#cb28-9"></a>       <span class="dt">title=</span><span class="st">&quot;Visits by day&quot;</span>, </span>
<span id="cb28-10"><a href="visit-frequency.html#cb28-10"></a>       <span class="dt">caption =</span> <span class="st">&quot;Source: Visitor Insights&quot;</span>)</span>
<span id="cb28-11"><a href="visit-frequency.html#cb28-11"></a></span>
<span id="cb28-12"><a href="visit-frequency.html#cb28-12"></a>g5 <span class="op">+</span></span>
<span id="cb28-13"><a href="visit-frequency.html#cb28-13"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), <span class="dt">legend.justification =</span> <span class="kw">c</span>(<span class="fl">1.2</span>, <span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb28-14"><a href="visit-frequency.html#cb28-14"></a><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="kw">guide_legend</span>(<span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>))</span></code></pre></div>
<p><img src="images/unnamed-chunk-18-1.png" width="672" /></p>
<p>Interestingly, the pattern of the data is quite different. The interval of 2017 to 2019 present a very similar figure. 2020 and 2021 show a different shape with higher amplitude in the distribution of visitors. This is a reflex of large differences in the numbers and is easily explained: the scheme was locked during the pandemic. This also explains why the data is negatively skewed in 2020. Conversely, in 2021 the distribution is positively skewed, as a response of a return to normality observed from April 2021.</p>
</div>
<div id="visits-by-time-intervals" class="section level2">
<h2><span class="header-section-number">2.3</span> Visits by Time Intervals</h2>
<p>Now that you know how to get date-time data, letâ€™s explore time intervals.</p>
<p>The file <em>visit_our.csv</em> presents the visit frequency of our shopping centre by hour. As all the other data, this has been extracted on VI platform.</p>
<p>As the previous section, first import the dataset into R.
We can then visualise the dataset using <code>facet_wrap()</code>to display the data into different year panels.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="visit-frequency.html#cb29-1"></a>data_hour &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;C:/Users/Laurent/OneDrive - ROCS/VI/visit_hour.csv&quot;</span>, <span class="dt">header=</span><span class="ot">TRUE</span>, <span class="dt">fileEncoding=</span><span class="st">&quot;UTF-8-BOM&quot;</span>)</span>
<span id="cb29-2"><a href="visit-frequency.html#cb29-2"></a></span>
<span id="cb29-3"><a href="visit-frequency.html#cb29-3"></a>data_hour &lt;-<span class="st"> </span>data_hour <span class="op">%&gt;%</span></span>
<span id="cb29-4"><a href="visit-frequency.html#cb29-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">as.character</span>(year))</span>
<span id="cb29-5"><a href="visit-frequency.html#cb29-5"></a></span>
<span id="cb29-6"><a href="visit-frequency.html#cb29-6"></a></span>
<span id="cb29-7"><a href="visit-frequency.html#cb29-7"></a>g13 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data_hour, <span class="kw">aes</span>(<span class="dt">x=</span>hour, <span class="dt">y=</span>pct)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb29-8"><a href="visit-frequency.html#cb29-8"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>)<span class="op">+</span></span>
<span id="cb29-9"><a href="visit-frequency.html#cb29-9"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>year,<span class="dt">nrow =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb29-10"><a href="visit-frequency.html#cb29-10"></a><span class="st">  </span><span class="kw">theme_light</span>()<span class="op">+</span></span>
<span id="cb29-11"><a href="visit-frequency.html#cb29-11"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels=</span>percent) <span class="op">+</span></span>
<span id="cb29-12"><a href="visit-frequency.html#cb29-12"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y=</span><span class="st">&quot;perc (%)&quot;</span>, </span>
<span id="cb29-13"><a href="visit-frequency.html#cb29-13"></a>       <span class="dt">x=</span><span class="st">&quot;hour&quot;</span>, </span>
<span id="cb29-14"><a href="visit-frequency.html#cb29-14"></a>       <span class="dt">title=</span><span class="st">&quot;Visits by hour (%)&quot;</span>, </span>
<span id="cb29-15"><a href="visit-frequency.html#cb29-15"></a>       <span class="dt">caption =</span> <span class="st">&quot;Source: Visitor Insights&quot;</span>)</span>
<span id="cb29-16"><a href="visit-frequency.html#cb29-16"></a></span>
<span id="cb29-17"><a href="visit-frequency.html#cb29-17"></a><span class="kw">plot</span>(g13)</span></code></pre></div>
<p><img src="images/unnamed-chunk-19-1.png" width="672" /></p>
<p>Although the graph of visit by hour provides a sense of the most visited time intervals, It does not provide a clear picture of trends and differences between years. We clearly need to structure the graph in a different way to highlight trends in time intervals.</p>
<p>We can adopt a different strategy. First by defining range intervals of time. For instance, creating intervals for morning, afternoon and so on.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="visit-frequency.html#cb30-1"></a><span class="co"># creating time range intervals</span></span>
<span id="cb30-2"><a href="visit-frequency.html#cb30-2"></a>morning &lt;-<span class="st"> </span><span class="kw">filter</span> (data_hour, hour <span class="op">==</span><span class="st"> &quot;6&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;7&quot;</span><span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;8&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;9&quot;</span>)</span>
<span id="cb30-3"><a href="visit-frequency.html#cb30-3"></a>mid_morning &lt;-<span class="st"> </span><span class="kw">filter</span> (data_hour, hour <span class="op">==</span><span class="st"> &quot;10&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;11&quot;</span>)</span>
<span id="cb30-4"><a href="visit-frequency.html#cb30-4"></a>noon &lt;-<span class="st"> </span><span class="kw">filter</span>  (data_hour, hour <span class="op">==</span><span class="st"> &quot;12&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;13&quot;</span>)</span>
<span id="cb30-5"><a href="visit-frequency.html#cb30-5"></a>afternoon &lt;-<span class="st"> </span><span class="kw">filter</span> (data_hour, hour <span class="op">==</span><span class="st"> &quot;14&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;15&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;16&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;17&quot;</span>)</span>
<span id="cb30-6"><a href="visit-frequency.html#cb30-6"></a>evening &lt;-<span class="st"> </span><span class="kw">filter</span> (data_hour, hour <span class="op">==</span><span class="st"> &quot;18&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;19&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;20&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;21&quot;</span>)</span>
<span id="cb30-7"><a href="visit-frequency.html#cb30-7"></a>night &lt;-<span class="st"> </span><span class="kw">filter</span> (data_hour, hour <span class="op">==</span><span class="st"> &quot;22&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;23&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;0&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;1&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;2&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;3&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;4&quot;</span> <span class="op">|</span><span class="st"> </span>hour <span class="op">==</span><span class="st"> &quot;5&quot;</span>)</span></code></pre></div>
<p>Then, we could create a field <em>period</em> to label each time interval.
We must also rely on the function <code>full_join()</code> to concatenate the objects for different period.</p>
<pre><code>## Joining, by = c(&quot;pid&quot;, &quot;name&quot;, &quot;year&quot;, &quot;hour&quot;, &quot;avg_visits&quot;, &quot;total_visits_year&quot;, &quot;pct&quot;, &quot;period&quot;)
## Joining, by = c(&quot;pid&quot;, &quot;name&quot;, &quot;year&quot;, &quot;hour&quot;, &quot;avg_visits&quot;, &quot;total_visits_year&quot;, &quot;pct&quot;, &quot;period&quot;)
## Joining, by = c(&quot;pid&quot;, &quot;name&quot;, &quot;year&quot;, &quot;hour&quot;, &quot;avg_visits&quot;, &quot;total_visits_year&quot;, &quot;pct&quot;, &quot;period&quot;)
## Joining, by = c(&quot;pid&quot;, &quot;name&quot;, &quot;year&quot;, &quot;hour&quot;, &quot;avg_visits&quot;, &quot;total_visits_year&quot;, &quot;pct&quot;, &quot;period&quot;)
## Joining, by = c(&quot;pid&quot;, &quot;name&quot;, &quot;year&quot;, &quot;hour&quot;, &quot;avg_visits&quot;, &quot;total_visits_year&quot;, &quot;pct&quot;, &quot;period&quot;)</code></pre>
<p>Finally,we can rename the intervals to provide a clear label for each one and set up the graph using <code>facet_wrap()</code>to display the data into different periods of time.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="visit-frequency.html#cb32-1"></a><span class="co"># re-order time interval</span></span>
<span id="cb32-2"><a href="visit-frequency.html#cb32-2"></a>data_hour &lt;-<span class="st"> </span>data_hour_period <span class="op">%&gt;%</span></span>
<span id="cb32-3"><a href="visit-frequency.html#cb32-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">period =</span> <span class="kw">fct_relevel</span>(period, </span>
<span id="cb32-4"><a href="visit-frequency.html#cb32-4"></a>                              <span class="st">&quot;Morning (6:00 - 9:59)&quot;</span>, <span class="st">&quot;Mid-morning (10:00 - 11:59)&quot;</span>, <span class="st">&quot;Noon (12:00 - 13:59)&quot;</span>, </span>
<span id="cb32-5"><a href="visit-frequency.html#cb32-5"></a>                              <span class="st">&quot;Afternoon (14:00 - 17:59)&quot;</span>, <span class="st">&quot;Evening (18:00 - 21:59)&quot;</span>, <span class="st">&quot;Night (22:00 - 5:59)&quot;</span>))  </span>
<span id="cb32-6"><a href="visit-frequency.html#cb32-6"></a></span>
<span id="cb32-7"><a href="visit-frequency.html#cb32-7"></a></span>
<span id="cb32-8"><a href="visit-frequency.html#cb32-8"></a><span class="co"># summarise the percentage of visitors by year and period </span></span>
<span id="cb32-9"><a href="visit-frequency.html#cb32-9"></a>data_hour &lt;-<span class="st"> </span>data_hour <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb32-10"><a href="visit-frequency.html#cb32-10"></a><span class="st">  </span><span class="kw">group_by</span>(year, period) <span class="op">%&gt;%</span></span>
<span id="cb32-11"><a href="visit-frequency.html#cb32-11"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">pct =</span> <span class="kw">sum</span>(pct)) </span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="visit-frequency.html#cb34-1"></a>g14 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data_hour, <span class="kw">aes</span>(<span class="dt">fill=</span> period, <span class="dt">y=</span> pct,  <span class="dt">x=</span> year)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb34-2"><a href="visit-frequency.html#cb34-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="st">&quot;dodge&quot;</span>, <span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;blue4&quot;</span>) <span class="op">+</span></span>
<span id="cb34-3"><a href="visit-frequency.html#cb34-3"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> scales<span class="op">::</span><span class="kw">percent</span>((pct),.<span class="dv">2</span>),</span>
<span id="cb34-4"><a href="visit-frequency.html#cb34-4"></a>                <span class="dt">y =</span> pct, </span>
<span id="cb34-5"><a href="visit-frequency.html#cb34-5"></a>                <span class="dt">group =</span> year,),</span>
<span id="cb34-6"><a href="visit-frequency.html#cb34-6"></a>            <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">0.9</span>),</span>
<span id="cb34-7"><a href="visit-frequency.html#cb34-7"></a>            <span class="dt">vjust =</span> <span class="fl">1.5</span>,</span>
<span id="cb34-8"><a href="visit-frequency.html#cb34-8"></a>            <span class="dt">colour=</span><span class="st">&quot;white&quot;</span>,</span>
<span id="cb34-9"><a href="visit-frequency.html#cb34-9"></a>            <span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb34-10"><a href="visit-frequency.html#cb34-10"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>period) <span class="op">+</span></span>
<span id="cb34-11"><a href="visit-frequency.html#cb34-11"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;none&quot;</span>) <span class="op">+</span></span>
<span id="cb34-12"><a href="visit-frequency.html#cb34-12"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels=</span>percent) <span class="op">+</span></span>
<span id="cb34-13"><a href="visit-frequency.html#cb34-13"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;perc.(%)&quot;</span>, </span>
<span id="cb34-14"><a href="visit-frequency.html#cb34-14"></a>       <span class="dt">x =</span> <span class="st">&quot;year&quot;</span>, </span>
<span id="cb34-15"><a href="visit-frequency.html#cb34-15"></a>       <span class="dt">title=</span><span class="st">&quot;Daily period ranges&quot;</span>, </span>
<span id="cb34-16"><a href="visit-frequency.html#cb34-16"></a>       <span class="dt">caption =</span> <span class="st">&quot;Source: Visitor Insights&quot;</span>)</span>
<span id="cb34-17"><a href="visit-frequency.html#cb34-17"></a></span>
<span id="cb34-18"><a href="visit-frequency.html#cb34-18"></a><span class="kw">plot</span>(g14)</span></code></pre></div>
<p><img src="images/unnamed-chunk-22-1.png" width="672" /></p>
<p>The graph provides a clear visualisation of the most busy intervals of time. It also highlights trends from 2017 to 2021.</p>
<p>You can try to study different time intervals with the same strategy. It always advisable to customise the code for your needs.</p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="7">
<li id="fn7"><p>A full descrition of the package is available at <a href="https://plotly.com/r/">https://plotly.com/r/</a><a href="visit-frequency.html#fnref7" class="footnote-back">â†©ï¸Ž</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introduction.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="visitor-behaviour.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
